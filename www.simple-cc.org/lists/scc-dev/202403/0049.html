<?xml version="1.0" encoding="us-ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />
<meta name="generator" content="hypermail 2.3.0, see http://www.hypermail-project.org/" />
<title>Re: [scc-dev] aarch64 support from Roberto E. Vargas Caballero on 2024-03-12 (scc-dev)</title>
<meta name="Author" content="Roberto E. Vargas Caballero (k0ga_at_shike2.com)" />
<meta name="Subject" content="Re: [scc-dev] aarch64 support" />
<meta name="Date" content="2024-03-12" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
.period {font-weight: bold}
</style>
</head>
<body>
<div class="head">
<h1>Re: [scc-dev] aarch64 support</h1>
<!-- received="Tue, 12 Mar 2024 20:02:21 +0100" -->
<!-- isoreceived="20240312190221" -->
<!-- sent="Tue, 12 Mar 2024 20:02:21 +0100" -->
<!-- isosent="20240312190221" -->
<!-- name="Roberto E. Vargas Caballero" -->
<!-- email="k0ga_at_shike2.com" -->
<!-- subject="Re: [scc-dev] aarch64 support" -->
<!-- id="ZfCmvfFDcnyYKQZ3_at_simple-cc.openbsd.amsterdam" -->
<!-- charset="us-ascii" -->
<!-- inreplyto="arch/inttypes.h" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="0049.html#start49" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ More options (<a href="0049.html#options2">top</a>, <a href="0049.html#options3">bottom</a>) ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="0050.html" title="Brian Mayer: &quot;Re: [scc-dev] aarch64 support&quot;">Next message</a> ]
[ <a href="0048.html" title="Brian Mayer: &quot;Re: [scc-dev] aarch64 support.&quot;">Previous message</a> ]
[ <a href="0048.html" title="Message to which this message replies: &quot;Brian Mayer&quot;">Re: [scc-dev] aarch64 support.</a> ]
<!-- unextthread="start" -->
 [ <a href="0050.html" title="Brian Mayer: &quot;Re: [scc-dev] aarch64 support&quot;">Next in thread</a> ]
 [ <a href="0049.html#replies">Replies</a> ]
<!-- ureply="end" -->
</li>
</ul>
</map>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="date.html#msg49" title="Contemporary messages by date">by date</a> ] [ <a href="index.html#msg49" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg49" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg49" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Roberto E. Vargas Caballero &lt;<a href="mailto:k0ga_at_shike2.com?Subject=Re%3A%20%5Bscc-dev%5D%20aarch64%20support">k0ga_at_shike2.com</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: Tue, 12 Mar 2024 20:02:21 +0100</span><br />
</address>
<br />
Hi,
<br />
<br />On Sat, Mar 09, 2024 at 05:14:46PM -0300, Brian Mayer wrote:
<br />
<a href="0048.html#0049qlink1">&gt; I ran make after cleaning it up and getting your commit. This time the
</a><br>
<em class="quotelev1">&gt; compilation goes further until this happens:
</em><br><br />Yeah, as I commented many bugs were expected to happen ^^!!!!
<br />
<br /><a href="0048.html#0049qlink2">&gt; This was the Makefile in the root folder not having the aarch64
</a><br>
<em class="quotelev1">&gt; target, so I added it to the scripts/arm64.mk file which gets included
</em><br><em class="quotelev1">&gt; in the Makefile. Like this:
</em><br><em class="quotelev1">&gt; 
</em><br><em class="quotelev1">&gt; diff --git a/scripts/arm64.mk b/scripts/arm64.mk
</em><br><em class="quotelev1">&gt; index 949eb49b..f6ae8961 100644
</em><br><em class="quotelev1">&gt; --- a/scripts/arm64.mk
</em><br><em class="quotelev1">&gt; +++ b/scripts/arm64.mk
</em><br><em class="quotelev1">&gt; _at_&#64; -1,6 +1,9 &#64;&#64;
</em><br><em class="quotelev1">&gt;  arm64:
</em><br><em class="quotelev1">&gt;         +_at_$(MAKE) `$(SCRIPTDIR)/config` CONF=arm64-linux libc libcrt
</em><br><em class="quotelev1">&gt; 
</em><br><em class="quotelev1">&gt; +aarch64:
</em><br><em class="quotelev1">&gt; +       +_at_$(MAKE) `$(SCRIPTDIR)/config` CONF=arm64-linux libc libcrt
</em><br><em class="quotelev1">&gt; +
</em><br><em class="quotelev1">&gt;  install-arm64: arm64
</em><br><em class="quotelev1">&gt;         $(SCRIPTDIR)/install -p $(SCRIPTDIR)/proto.arm64 $(ROOT)
</em><br><br />Good change, I am going to push it (also with the addition of the required
<br />
install-aarch64 and install-aarch64).
<br />
<br /><a href="0048.html#0049qlink3">&gt; Not sure if this is the right choice. So running make again takes it
</a><br>
<em class="quotelev1">&gt; further but there comes a new error:
</em><br><em class="quotelev1">&gt; 
</em><br><em class="quotelev1">&gt; make[4]: Entering directory '/home/blmayer/git/distro/scc/src/libc/inttypes'
</em><br><em class="quotelev1">&gt; gcc -I../../../include -I../../../include/bits/linux
</em><br><em class="quotelev1">&gt; -I../../../include/bits/arm64 -I../../../include/bits/linux/arm64
</em><br><em class="quotelev1">&gt; -ffreestanding -fno-pie   -std=c99 -fno-stack-protector -static  -O1
</em><br><em class="quotelev1">&gt; -o imaxabs.o -c imaxabs.c
</em><br><em class="quotelev1">&gt; In file included from ../../../include/stdint.h:8,
</em><br><em class="quotelev1">&gt;                  from ../../../include/inttypes.h:4,
</em><br><em class="quotelev1">&gt;                  from imaxabs.c:1:
</em><br><em class="quotelev1">&gt; ../../../include/bits/linux/arm64/arch/stdint.h:103:23: error: two or
</em><br><em class="quotelev1">&gt; more data types in declaration specifiers
</em><br><em class="quotelev1">&gt;   103 | typedef unsigned char int uint_fast8_t;
</em><br><em class="quotelev1">&gt;       |                       ^~~
</em><br><br />There was a stupid type and that int had to be removed. I have pushed the fix.
<br />
<br /><br /><a href="0048.html#0049qlink4">&gt; ../../../include/inttypes.h:5:10: fatal error: arch/inttypes.h: No
</a><br>
<em class="quotelev1">&gt; such file or directory
</em><br><em class="quotelev1">&gt;     5 | #include &lt;arch/inttypes.h&gt;
</em><br><em class="quotelev1">&gt;       |          ^~~~~~~~~~~~~~~~~
</em><br><em class="quotelev1">&gt; compilation terminated.
</em><br><br />The file include/bits/linux/arm64/arch/inttypes.h was missed. I have pushed
<br />
it (It is basically the same than amd64, I have reviewed it, but it would
<br />
be nice if someone else does it).
<br />
<br /><br /><a href="0048.html#0049qlink5">&gt; Note that only sigaction.s has 2 &quot;_&quot; before it. So I removed it, by
</a><br>
<em class="quotelev1">&gt; editing the file src/libc/arch/arm64/linux/syscall.lst. This may be
</em><br><em class="quotelev1">&gt; some Makefile with a typo. I'm not sure if that's correct, but
</em><br><em class="quotelev1">&gt; compilation ran further:
</em><br><br />The typo was in the Makefile, where it listed _sigaction.o instead of
<br />
__sigaction.o. I have pushed the fix it.
<br />
<br /><br /><em class="quotelev1">&gt; After taking a look at:
</em><br><em class="quotelev1">&gt; <a href="https://pubs.opengroup.org/onlinepubs/7908799/xsh/signal.h.html">https://pubs.opengroup.org/onlinepubs/7908799/xsh/signal.h.html</a>. I
</em><br><a href="0048.html#0049qlink6">&gt; edited that file and changed the following:
</a><br>
<em class="quotelev1">&gt; 
</em><br><em class="quotelev1">&gt; diff --git a/src/libc/arch/posix/signal.c b/src/libc/arch/posix/signal.c
</em><br><em class="quotelev1">&gt; index 7bff34b0..3f04e164 100644
</em><br><em class="quotelev1">&gt; --- a/src/libc/arch/posix/signal.c
</em><br><em class="quotelev1">&gt; +++ b/src/libc/arch/posix/signal.c
</em><br><em class="quotelev1">&gt; _at_&#64; -1,8 +1,7 &#64;&#64;
</em><br><em class="quotelev1">&gt;  #include &lt;signal.h&gt;
</em><br><em class="quotelev1">&gt;  #include &lt;stddef.h&gt;
</em><br><em class="quotelev1">&gt; 
</em><br><em class="quotelev1">&gt; -#include &lt;arch/sigaction.h&gt;
</em><br><em class="quotelev1">&gt; -#include &lt;sys.h&gt;
</em><br><em class="quotelev1">&gt; +#include &lt;signal.h&gt;
</em><br><em class="quotelev1">&gt; 
</em><br><em class="quotelev1">&gt;  #undef signal
</em><br><em class="quotelev1">&gt; 
</em><br><em class="quotelev1">&gt; _at_&#64; -13,7 +12,7 &#64;&#64; void
</em><br><em class="quotelev1">&gt;                 .sa_handler = func,
</em><br><em class="quotelev1">&gt;         };
</em><br><em class="quotelev1">&gt; 
</em><br><em class="quotelev1">&gt; -       if (_sigaction(signum, &amp;sa, &amp;osa) &lt; 0)
</em><br><em class="quotelev1">&gt; +       if (sigaction(signum, &amp;sa, &amp;osa) &lt; 0)
</em><br><em class="quotelev1">&gt;                 return SIG_ERR;
</em><br><em class="quotelev1">&gt; 
</em><br><em class="quotelev1">&gt;         return osa.sa_handler;
</em><br><br />In this case the solution that you applied was not good, because the issue
<br />
here was that include/bits/linux/arm64/arch/sigaction.h was missed. I think
<br />
the definition of struct sigaction is the same in both cases is the same,
<br />
but I am not so sure about the definition of SA_RESTORER. Can you try a small
<br />
program with glibc and print the value of SA_RESTORER?
<br />
<br /><br />Please, can you check the new master and see how much the build progress now?
<br />
<br />Regards,
<br />
<pre>
--
To unsubscribe send a mail to scc-dev+unsubscribe_at_simple-cc.org
</pre>
<span id="received"><dfn>Received on</dfn> Tue 12 Mar 2024 - 20:02:21 CET</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="0049.html#start49">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="0050.html" title="Next message in the list">Brian Mayer: "Re: [scc-dev] aarch64 support"</a></li>
<li><dfn>In reply to</dfn> <a href="0048.html" title="Message to which this message replies">Brian Mayer: "Re: [scc-dev] aarch64 support."</a></li>
<!-- lnextthread="start" -->
<li><dfn>Next in thread</dfn>: <a href="0050.html" title="Next message in this discussion thread">Brian Mayer: "Re: [scc-dev] aarch64 support"</a></li>
<li><a name="replies" id="replies"></a><dfn>Reply</dfn>:  <a href="0050.html" title="Message sent in reply to this message">Brian Mayer: "Re: [scc-dev] aarch64 support"</a></li>
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options3" id="options3"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="date.html#msg49" title="Contemporary messages by date">by date</a> ] [ <a href="index.html#msg49" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg49" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg49" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail-project.org/">hypermail 2.3.0</a>
: Tue 12 Mar 2024 - 20:10:47 CET
</em></small></p>
</body>
</html>
