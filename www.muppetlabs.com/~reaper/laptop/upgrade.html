<html>
<head>
<title> Upgrading the hard drive </title>
</head>
<body>

<p><hr><hr>
<h1> Upgrading the hard drive of the T-3400 </h1>
<p><hr><hr>

<p> The 120 MB drive which came with my computer has turned out to be
impractically small, so I've decided to upgrade.  At this point in the
game, I'm still working on finding a drive, and finding out about the
process, but I'll keep this page updated, in case others find my
experience useful.  

<p> At this stage, it'll be text only, but when I've actually
purchased a new drive, I'll be taking pictures of the process, and
detailing how it was all done.  The pictures will be scanned in, if
they look useful.

<p><hr>

<p><font size=5>22 January, 1996</font> I went to a Toshiba-authorized
repair center today to ask them about
warrantees, and what their prices on drives were like.  The basic (and
unofficial) answers I got: 

<ul>
	<p><li> The warrantee will <em>technically</em> be voided by 
replacing the drive.  In this case, that means that if I keep the old
drive, and stick it back in for warrantee service, no one will know
the difference.

	<p><li> The HD controller is only IDE, so any hard drive will
have to be <strong>under 528MB</strong>.  The person I talked to said
that this also means that overlay software, which is meant to trick
a large drive into working, <strong>will not work</strong>.  Important
point.

	<p><li> The drive will have to be a 12mm slimline-type, or it
won't fit in the small case of the T-3400.

	<p><li> According to a document at 
<a href="http://warrior.com/">Road Warrior</a>, a sort of high-tech gadgety 
store, it's not necessary to upgrade the BIOS in the T-3400/3600 when
you upgrade the hard drive.
</ul>

<p> So far, what I've decided to do is get a 540 or 520 MB drive
(since the 540 in my desktop formatted down to 520 anyway).  Now, all that
remains is the actual purchase, and installation.  

<p> One important point is how to transfer the data from the old drive
to the new.  I'd rather not re-install Slackware from scratch, since
that seems like unnecessary work.  I've put a message out on a local
Linux newsgroup, asking for someone with some free time and disk
space; hopefully, I can just stick an image of my disk onto someone
else's computer, and re-copy it back when I'm finished.  I know it
won't be that easy, but it's the best idea I've had so far...

<p> Keep an eye on this page, as it will be updated as events happen.

<p><font size=5>25 January, 1996</font> I decided that I should 
investigate the difficulty involved in opening up the computer (plus,
I really wanted to see what was inside).  I have now successfully
opened and re-sealed the computer twice.  The first time was for
experimental reasons only, and the second time was to fix a loose
connector I had left from the first time.  (Oops)

<p> Opening the computer up isn't very difficult, as long as you are
careful.  Taking out all the screws (11 in total, I believe) that hold
the two halves together, it is necessary to further lever the pieces
apart, due to the little tabs holding them together.  The easiest way
I found to do this was to swing the little feet at the back out, and
use them as handles, gently pulling on them, and levering against the
top of the rear IO port panel.  Keep in mind that you probably want to
have that panel open, since it bears on both sides of the case.

<p> It was necessary to go round the edges of the case with a knife
(in this case, the 'can opener' blade of a swiss army knife), and <em>
very carefully</em> pry the pieces apart.  In my case, the hardest tab
to undo was the one right above the little power status light on the
front left of the machine.  I had to press fairly hard against that
panel to get it unsprung.

<p> I want to stress that you should <strong>not use too much
force</strong> or you'll probably break something.  

<p> When you finally get the case halves separated, you'll find that
there are three cables connecting them together.  One is actually a
great cluster of wires, and appears to be the screen's connection.
The one a bit off center, but inward from that, appears to be the
keyboard and indicator-light connector, and there's a cable on the far
opposite side, which connects in some way to the hard drive.

<p> The problem I ran into was that the keyboard cable came
disconnected very easily.  This isn't really bad, it's just something
to look out for.  It can be pushed back into place with a minimum of
fuss.  If you're actually looking at the inside of the computer, it's
the flat ribbon cable in the middle of the case.

<p> After the first time opening it up, I became gradually aware that
the power and AC lights were flashing as I typed.  This was really
annoying, but more importantly, might have been a short circuit (it
wasn't after all, but it had me worried).  What had happened was that
what I'm calling the keyboard cable had been pulled half-way out of
its socket, and when i pressed even slightly on the keyboard (less
pressure than necessary to engage a key), it would flex the cable, and
presumably move the connector slightly out of place.

<p> Re-seating the cable fixed the problem.

<p><font size=5>12 February, 1996</font> I've bought a drive, and it's
arrived (after some hassle with shipping -- it was sent a week after I
ordered it for some reason which wasn't explained to me).  I decided to
go for a 540 MB drive, on the theory that a plain IDE environment should
be able to cope with the 520 MB it should format down to.  The actual
drive I bought is a <b>Toshiba MK1924FCV 543 MB, 12ms, 5 V, .7A</b>
hard disk.  I paid &#156;205 + &#156;37 VAT for the drive, and ordered
it from Watford Electronics.  If you decide to order
anything from Watford, keep in mind that they were not very
communicative with me (ie., didn't contact me at all after I had
placed the order), delayed my order a week for no explicable reason, and
(whether intentionally or not) tried to charge me &#156;10 more than
their advertised price.

<p> <a href="mailto:dchow@fuz.triadtech.com">David Chow</a> mailed me a
few days ago, to say that he has a 
<a href="http://fuz.ttk.com/~dchow/T3400CT">page</a> up which details 
all his modifications to his T-3400.  It's not very polished yet, but
provides some good information, such as, for instance, that it's
perfectly reasonable to use a drive larger than the 528 MB limit, if you
keep your partitions smaller than 528 MB...  He's currently using a 777
MB drive (I think) with great success.  He's also running with a
DX4-100, which is a bit more radical than i would get.  Apparently it
works fine, though...

<p> I've made arrangements to do the data transfer on Wednesday, and
will be posting much more then.  Check back after Wednesday to see what
happened.

<p><font size=5>February 16, 1996</font>  I've installed the new drive,
and what a difference!  This drive (a Toshiba MK1924FCV as noted above)
is orders of magnitude quieter than the old one.  That was definitely
the first thing I noticed: the 120 was so loud that i couldn't use the
computer in class since the drive spinning down then up again was
distracting people.  Well, the new drive won't have that problem; I
can't hear it right now, and the only noise in the room is fairly quiet
music from a small portable stereo.  Of course, I've also got a bit over
400 megs free now, which is a fairly liberating thought.

<p> The actual installation was very painless.  From a purely hardware
standpoint, it was as easy as taking apart the two halves of the
computer, unscrewing the old drive, and reconnecting the new drive.
There were no real problems to speak of, but there are a few things I
want to mention.

<p> The first one is a brief description of the internals of the T-3400
as regards taking it apart.  There are four cables between the two
halves of the case, which I believe I can safely identify.  I'll
describe them from the vantage of the rear of the computer, sitting on
its feet.  

<ul>

<p><li> From the left, the first cable is actually a mass of wires,
which feeds up to the display.  These wires branch out into a small
'normal' sort of connector on the motherboard.  This connector is easily
lifted out of the socket by carefully prying on the edges with a small
flat-bladed screwdriver.  It's just a pressure fit, there aren't any
catches on it.

<p><li> The second cable is really a piece of flexible circuit-board, if
you like.  It's not a cable in the sense of insulated wires as much as
it is metal tracings on a flexible surface.  It plugs into what I will
call a 'not-normal' plug, in that there is no connection-making bit on
the end.  There's no 'plug' in the accepted sense of the word, just a
flat bit of plastic with tracings etched onto it.  It plugs into a
little socket on the motherboard, which has a clamping device to keep
the cable from pulling out.  it's actually the top of the socket, and it
raises up to release the cable: you'll need that flat-headed screwdriver
again.  I believe this is the keyboard cable (that is, it's got the
right number of conductors for the task).

<p><li> The next cable is the same idea as the keyboard cable, but
thinner.  I think this is the 'status light' cable, which powers
the various LED's showing power, caps lock, etc.  I don't believe it
carries the hard drive activity signal, though.  On my computer, this
cable was not the most solidly-connected I've ever seen, but it was fine
if you seated it right.  It looked like the socket had been tested one
too many times, making the click-lock sort of insecure.

<p><li> This brings us to the fourth cable, which I believe is the hard
drive activity light signal.  It is the same type of cable as the last
two, with etched conductors on a flexible plastic of some kind.  This
one isn't actually connected to the motherboard proper, but rather to
the top of the hard drive connector.  It uses the same type of
compression-lock socket, but it's mounted on more of this flexible
plastic, and can be sort of tricky to unlock.  I'm sure the plastic is
quite strong, but be careful if you're trying to undo the socket.

</ul>

<p> Once I had the two halves of the case separated, it was a fairly
straightforward operation to unscrew the hard drive retaining cage from
the case, and pull the drive assembly out.  Once out of the computer,
removing the drive from the cage was a matter of undoing three screws,
and unplugging the connector from the drive.  There's a clever little
setup to get the signals from the drive to the motherboard, which is
another flexible plastic sheet with conductors and a few components on
it, which routes the signals across the necessary 2 inches.  It is into
this sheet that the HD light cable plugs.

<p> Fitting the new drive was a very simple case of reversing everything
that I had previously undone. The only thing I'd add to this is that
it's fairly helpful to have a second person around to hold up half of
the case when you're re-connecting the cables.  Re-connecting the cables
is completely straightforward, since plugging them in backwards would
require that someone have not only the observational skills, but also
the lack of common sense normally attributed to your basic eggplant. 

<p> Once I had the new drive fitted, I put the halves of the case
together, without actually snapping it together, and powered it up, just
to see that everything was really connected like it should be.
Everything worked fine, so I snapped it shut and put all the screws back
in.

<p><hr>

<p> At this point, it becomes necessary to talk about the software side
of things, namely, the transfer of data.  If you don't have anything
on your old drive that you want to save (for instance, your cheezy
Windows installation with loads of unregistered shareware games or
something), you can safely skip this step, and get started installing
your favorite distribution from floppies (a slow and occasionally
annoying process).

<p> First, let me say a few words about what you should have prepared
beforehand.  I used PLIP to transfer data, which is highly recommended.
Or, if you have an Ethernet card and can find a networkable Linux PC to
work with, even better.  But before you start, you will in all
circumstances want to have the following ready:

<ul>

<p><li> A boot/root disk set which fully supports the setup you intend
to use, including:

<ul>

<p><li> A kernel with net support, and whatever kind of interface you'll
be using. (PLIP, SLIP, Ethernet card, etc.)
<li> A <strong>full, useful</strong> set of net utilities, including
<i>ifconfig</i>, <i>route</i>, <i>ping</i>, <i>ftp</i>, etc.
<li> A reasonable set of other utils, like <i>ls</i>, <i>cat</i>, <i>tar</i>,
<i>gzip</i>, <i>vi</i>, <i>bash</i>, <i>mke2fs</i>, <i>fdisk</i>, etc.
<li> A copy of your /etc/group and /etc/passwd files
<li> If your utils are ELF, make damn sure your kernel supports ELF too.

</ul>

<p><li> A Linux PC ready to store your data for a short while, which has
some method of transferring files, even if it's only SLIP compiled into
the kernel plus a null modem cable.

<p><li> A proper cable. (PLIP requires a special 25 pin to 25 pin cable,
details of which are available elsewhere, SLIP requires a null-modem
cable, Ethernet requires special cabling, but you know that if you're
using it, etc.)

<p><li> If you don't feel confident about your knowledge of all the
deep-down network stuff about to happen, you'll most likely want to have 
someone who does.

<p><li> <strong>Lots of time</strong>.  (It took me 7 hours to
completely do the installation from start to finish.)  I suggest that
you reserve a day to do it, probably on the weekend when you've got
nothing else to worry about.

<p><li> If you're not going to be trying to do everything across a
network, you should definitely have some distribution disks handy, such
as the A and N series from the Slackware set.  This will give you enough
utilites to do your basic network slurping.

</ul>

<p> The method we ended up using (Stephen Tweedie volunteered to help
me, and unless otherwise noted, 'we' means he and I) was to set up the
PLIP connection, and create a tarfile of each of my partitions on his
computer over the PLIP
link.  This was done with the following command (from the / directory):

<pre><code>
tar czlf lucy:root.tar.gz /

</pre></code>

In this case, <strong>lucy</strong> is his computer.  This creates a
compressed tarfile on the remote computer, of only one filesystem (the
<i>l</i> option).  The same command was reissued for the /usr partition,
with the obvious modifications.  The whole operation probably took half
an hour to complete but this is highly dependent on your data-transfer
method.  Obviously, the slower your link, the longer it'll take.

<p> Once the transfer was complete, we backed up my data to a QIC80 tape
(might as well, since it was there), which took a fair whack of time.
Then, once the data on the tape was verified, I went ahead and replaced
the drive (described above).

<p> Transferring the data back was interesting, but mostly because we
weren't quite as prepared as we had hoped.  It turned out that we were
missing some vital utilities on our disk set, and that the kernel we
were using had lp drivers compiled in (PLIP and lp can't exist at the
same time).  I suspect we spent about 2 hours getting the software and
stuff right, including recompiling a kernel on his DX4-100.

<p> The method we used to get the data back on the new drive was, I
suspect, not the best one.  This was mostly due to a lack of resources
(floppy disks, in this case).  We ended up transferring the two tarfiles
back to what was to be my /usr partition with ftp, and unpacking them
from there.  This caused its own set of problems, mostly to do with
permissions.

<p> What you most likely want to do is to mount your / (root) partition
on your ramdisk's /mnt (this is assuming you're using a ramdisk or
something similar), and ftp the tarfiles to that partition.  Then, using
the <i>tar</i> utility that you carefully ensured was on your disk set,
unpack root.tar.gz (or whatever you've called it).  We used this
command (from /mnt on the ramdisk):

<pre><code>
tar xzvpf root.tar.gz

</pre></code>

I hope at this point that you got a copy of your /etc/group and 
/etc/passwd files onto your
disk set, since if you didn't you'll have a hell of a time getting
permissions and ownership back to the way you had them.  Note the
<i>p</i> option with tar; this will make sure that permissions are as
they should be.

<p> Now, you should mount your /usr partition (on your hard drive) onto
/mnt, as /mnt/usr, and do the same thing with usr.tar.gz that you did
with root.tar.gz.

<p> That, basically speaking, is how it should be done.  How it is
practically done, is, of course, never that simple.  The best advice I
can give you on that point is to make sure you're excited about spending
an entire day staring at a unix command line, trying to figure out why
the command that should do X is actually doing Y...  If you're not
motivated about this, you shouldn't be doing the upgrade yourself, you
should be paying a professional to do it.

<p> One final note: now that you've read through this whole messy
document, I want to say that I'll be producing a much cleaner, easier to
read page, which should contain the same information in a much more
easily apprehended format.  Look out for it soon...


<p><hr>
This page was designed and implemented by 
<a href="mailto:reaper@muppetlabs.com">Ian Johnston</a>.  Check out my
<a href="../index.html">homepage</a> for a laugh...
</body>
</html>
