---

name: "Refresh Archive"
run-name: "Refresh Archive"

on:
  workflow_dispatch:

  schedule:
    - cron: '0 0 1 * *'

  push:
    branches: main
    paths:
      - .github/workflows/refresh.yml

env:
  GH_TOKEN: ${{ secrets.AUTO_DOWNLOAD_ARCHIVE }}

jobs:
  refresh-archive:
    strategy:
      matrix: # this is hard coded for now, as not all websites are straightforward to archive, in the future this might be in file in the repo itself
        link:

          # sigbovik.org gets (roughly) yearly updates, so this just refreshes the current year
          - "sigbovik.org/2024/" # TODO: update this to be current year automatically?

          # bellard.org has a large tree so to be nice to the server this only refreshes specific disrectories
          - "bellard.org/tcc/"
          - "bellard.org/quickjs/"
          - "bellard.org/otcc/"
          - "bellard.org/bpg/"
          - "bellard.org/fbcc/"

          # tom7.org has a large tree so to be nice to the server this only refreshes specific disrectories
          - "tom7.org/papers/"
          - "tom7.org/chess/"
          - "tom7.org/talks/"

          # spec.commonmark.org/current doesn't redirect in wget the same way it does in the browser so this needs revisiting
          #- "spec.commonmark.org/current/spec.json"
          #- "spec.commonmark.org/current/changes.html"
          #- "spec.commonmark.org/current/index.html"

          # full site mirrors
          - "fabiensanglard.net/"
          - "www.simple-cc.org/"
          - "www.literateprogramming.com/"

    name: Refresh Archive
    runs-on: ubuntu-latest
    steps:
      - name: "Triger Archive Workflow"
        run: gh workflow run --repo "${REPO}" archive.yml -f url="${LINK}"
        env:
          REPO: '${{ github.repository }}'
          LINK: '${{ matrix.link }}'
