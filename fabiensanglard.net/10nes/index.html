<html>
<head>
  <link rel="alternate" type="application/rss+xml"  title="RSS Feed for fabiensanglard.net" href="https://fabiensanglard.net/rss.xml" />
  <style type="text/css">

    @font-face {
      font-family: 'fabfont';
      src: url('../font/DejaVuSansMono.woff2');
      font-display: block;
    }

    @font-face {
      font-family: 'fabfont';
      src: url('../font/DejaVuSansMono-Bold.woff2');
      font-weight: bold;
      font-display: block;
    }

    * {
       font-size: 16px;
    }

    html {
      font-family: fabfont,  monospace;
      max-width: 900px;  /* For Desktop PC (see @media for Tablets/Phones) */
      padding-left: 2%;
      padding-right: 3%;
      margin: 0 auto;
      background: #F5F5F0;
  	} 
    


  	a {
      color: black;
      font-weight: bold;
    }

    img {
      border: none; 
    }

    p {
      margin-top: 0px;
      text-align: justify;
    }
    sup {
      vertical-align: 0.3em;
      font-size: 0.65em;
    }   

    pre {
      font-family: fabfont, monospace;
      background-color: white; 
      border: 1px solid Black; 
      padding-left: 2%;
      padding-top: 1ch;
      padding-bottom: 1ch;
      /* Only take care of X overflow since this is the only part that can be too wide.
         The Y axis will never overflow.
      */
      overflow: hidden;
    }

    div.heading {
      font-weight: bold;      
      text-transform: uppercase;
      margin-top: 4ch;
    }

    /** {
      font-size: 16px;
    }*/
    @media (max-width: 500px) { /* For small screen decices */
      * {
        font-size: 12px; 
      }
    }   
    .title {
      text-decoration: none;
    }

    img.pixel, canvas.pixel {
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }

    blockquote { 
    background-color: #f3f3f3;
    border: dashed 1px grey; 
    width: 97.5%; 
    font-style: italic; 
    text-align: justify;

    padding: 1ch; 
    padding-top: 2ch; 
    padding-bottom: 2ch;     
    
    margin : 0ch; 
    margin-bottom: 2ch; 
    margin-top: 0ch;
  }

  blockquote div {
    text-transform: none;
    text-align: right;
    width: 100%;
  }

  code {
    /*font-size: 110%;*/
    font-weight: bold;
    background-color: #e1e1e1;
    border-radius: 0.5ch;
    padding-left: 0.3ch;
    padding-right: 0.3ch;
  }

  .trivia {
    border-left: 1px black solid;
    padding-left: 1ch;
  }

  .trivia::before {
  font-weight: bold;
  text-decoration: underline;
  padding-right: 1ch;
  content: "Trivia:";

  </style>
  <title>10NES</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=12.0, minimum-scale=1.0, user-scalable=yes">
</head>  
  <body><br><center>
    <div style="display: inline-block; vertical-align:middle;">
<a href="https://fabiensanglard.net/" class="title"><b>FABIEN SANGLARD'S WEBSITE</b><br>
</a><hr/><div style="text-align: justify;display: inline-block; width: 100%;">
<!-- <a class="title" href="/about/index.html">ABOUT</a> &nbsp;<a class="title" href="/contact/index.html">EMAIL</a> &nbsp;<a class="title" href="../rss.xml">RSS</a> &nbsp;<a class="title" href="https://paypal.me/fabiensanglard">DONATE</a></div></div> -->
<a class="title" href="https://fabiensanglard.net/about/index.html">ABOUT</a> &nbsp;<a class="title" href="https://fabiensanglard.net/contact/index.html">CONTACT</a> &nbsp;<a class="title" href="https://fabiensanglard.net/rss.xml">RSS</a> &nbsp;<a class="title" href="https://paypal.me/fabiensanglard">GIVE</a></div></div>

</center><br><br>
<div style="margin-bottom: 2ch;text-transform: none;">
July 18, 2023</div>
<div class='heading'>10NES</div><hr/>
<style>
  img {
    border: 1px black solid;
  }
</style>
<p>I am a big fan of Street Fighter 2. Certainly not the greatest but likely among the nerdiest since I wrote an entire book about its <a href="https://fabiensanglard.net/cpsb_paper">platform</a><a name="back_1" style="text-decoration: none;" href="index.html#footnote_1"><sup>[1]</sup></a>. It won't be a surprise to learn that, back in December 1992, I was eagerly waiting for the Super Nintendo port so I could stop sinking my rare 10 Francs coins into the arcades.
</p>
 
<p>USA readers may wonder why I was waiting for the release of a game already published. While Street Fighter II made it to the Super Famicom on June 10, 1992 in Japan and July 15, 1992 in North America, France had to wait until December 17, 1992 to get a PAL version.
</p>

<p>As I waited, I saw ads<a name="back_2" style="text-decoration: none;" href="index.html#footnote_2"><sup>[2]</sup></a> in French magazines<a name="back_3" style="text-decoration: none;" href="index.html#footnote_3"><sup>[3]</sup></a> offering imported cartridges of my Holy Graal. To make them work on a European Super Nintendo, one had to buy an adapter. The combo cost almost as much as the console (595F + 199F vs 1290F).</p>

<p>Needless to say I couldn't afford it. But I always wondered how Nintendo seemingly controlled the regions and how tinkerers had managed to circumvent that protection.</p>

<!-- <p>Luckily, the magic of the Internet happened. Over the past decades, curious people have connected, worked together, and solved the mystery. All I had to do was gather what was sprinkled all over the net.</p>  -->
 
<!-- <img loading="lazy" src="shame.webp" width="500" height="496" style="width: 50%; height: auto; margin-left: auto;margin-right: auto; display: block;"/> -->

<!-- <div class='heading'>A few decades later...</div><hr/><p>
A few weeks ago, I decided to take the time to understand the SNES locking and zoning. As I started my research, the magic of Internet operated.</p>

<p>As it turned out, the network had put in touch thousand of people over the past decades. Together, they worked out the details of most of my interrogations. All I had to do was spend a few hours gathering pieces of knowledge here and there.</p>

<p>This page merely concentrates what other have spend countless hours discovering and kindly shared.</p>
 
  -->
<div class='heading'>10NES system and the CIC chip</div><hr/><p>Nintendo's region and licensing system is named 10NES. At its heart is the chip known as "CIC" (Checking Integrated Circuit). On the following Super Nintendo motherboard it is recognizable via its F411A<a name="back_4" style="text-decoration: none;" href="index.html#footnote_4"><sup>[4]</sup></a> label.</p>

<img loading="lazy" src="snesmotherboard.webp" width="1038" height="989" id="mobo" style="width: 100%; height: auto; margin-bottom:1ch; border:0;"/><script>
var img = document.getElementById("mobo");  
img.onclick = function(){
  if (img.src.endsWith(".webp")) {
    img.src = "snesmotherboard_no_font.svg";
  } else {
    img.src = "snesmotherboard.webp";
  }
};

</script> 
<span style="text-align: center; display: block; margin-bottom: 2ch;"><i><small>
<a href="https://upload.wikimedia.org/wikipedia/commons/5/5f/SNES-CPU-RGB01_01.jpg">Source</a>. Click the image to find the CIC chip.
</small></i></span>



<div class='heading'>CIC pinout</div><hr/><p>The CIC chip features 16 pins but not all of them are used. The pinout, published on nesdev.org<a name="back_5" style="text-decoration: none;" href="index.html#footnote_5"><sup>[5]</sup></a><a name="back_6" style="text-decoration: none;" href="index.html#footnote_6"><sup>[6]</sup></a>, allows us a glimpse into how it CIC works.</p>
<pre>              -----_----
 Data Out  <--|01    16|--- VCC +5V
 Data In   -->|02    15|
 Seed      -->|03    14|
 Config    -->|04    13|
              |05    12|
 CLK       -->|06    11|
 RST       -->|07    10|--> Slave CIC RST
 GND       ---|08    09|--> Host RST
              ----------</pre>
<p>In the set of pins, we find standard ones such as power (+5V), a ground (GRD), a Clock (CLK) to breathe life into the silicone, and a Reset (RST).
</p>                 







<div class='heading'>CIC on game cartridge</div><hr/><p>
  To understand the other pins, we need to introduce the second part of the 10NES system, an identical CIC chip located on the game cartridge. In the following cart (used among other titles for Secret Of Mana), the CIC is on the right, labeled D411B.</p>
</p>
<img loading="lazy" src="cart_top.webp" width="700" height="414" id="snes_cart" style="width: 100%; height: auto; margin-bottom:1ch; border:0;"/><span style="text-align: center; display: block; margin-bottom: 2ch;"><i><small>
<a href="https://snescentral.com/pcbboards.php?chip=SHVC-1J3M-20">Source</a>. Click the image to see the back of the cart.
</small></i></span>

<script>
var cart = document.getElementById("snes_cart");  
cart.onclick = function(){
  if (cart.src.endsWith("cart_bottom.webp")) {
    cart.src = "cart_top.webp";
  } else {
    cart.src = "cart_bottom.webp";
  } 
};

</script> 

<p><b><u>Trivia:</u></b> A deeply satisfying exercise with hardware from the 90s is to follow the bus lines. Try to follow the <code>+5V (VCC)</code> <a href="https://www.caitsith2.com/snes/flashcart/cart-chip-pinouts.html">cart pin</a> and see how it makes its way to pin 16 (<code>+5V (VCC)</code>) on the CIC (hint: It goes through a resistor and a capacitor).


<div class='heading'>The CIC Lock and Key</div><hr/><p>The two CICs in the 10NES system are identical. Pin <code>04</code> (CONF) configures how a chip should behave. Grounding it makes it behave like a Key but connecting it to power makes it behave like a Lock. On every system it was used, the Lock is in the console and the Key is in the game cartridge.</p>

<p> The two I/O pins, <code>01</code> (OUT) and <code>02</code> (IN), are paired to each other so the chips can communicate. Since both CIC use the same <code>CLK</code>, they execute instructions in lockstep and are synchronized.</p>


<img loading="lazy" src="cic_duo_nofont.svg" width="489mm" height="271mm" style="width: 100%; height: auto; margin-bottom:2ch; border:0;"/>

<p>Both the Lock and the Key generate a signal on their <code>OUT</code> pin and compare it to what is received on their <code>IN</code> pin. If it detects a discrepancy, the Lock asserts its <code>HST RST</code> (HoST ReSeT) pin which triggers a <code>RST</code> on the graphic chip PPU2. This signal is <a href="snes_schematic.pdf">distributed</a> to all other components of the machine (CPU, PPU1, APU, DSP) every 1s making the overall system unusable.</p>

<div class='heading'>RST pin</div><hr/><p>The Lock's <code>RST</code> pin is directly connected to the console RESET button. When this pin is asserted, it automatically asserts <code>KEY RST</code> (pin <code>07</code>) which is connected to the <code>RST</code> pin of the Key CIC on the cartridge.</p>

<div class='heading'>Seed</div><hr/><p>To generate a pseudo random signal, the Lock needs a seed value. It is generated thanks to a capacitor connected to its <code>SEED</code> pin<a name="back_7" style="text-decoration: none;" href="index.html#footnote_7"><sup>[7]</sup></a>. The randomness comes from how long it takes for the capacitor to discharge. After it gets its seed value, the Lock sends it to the Key as part of the prologue (therefore the Key <code>SEED</code> pin is unused and grounded). After that both the Key and the Lock start issuing one of the 16 possible streams<a name="back_8" style="text-decoration: none;" href="index.html#footnote_8"><sup>[8]</sup></a>.</p>

<p>On top of using the same <code>CLK</code> signal, both chips stay in sync via careful programming. They don't always take the same code path but developers made sure instructions of each branch take the same number of cycles<a name="back_9" style="text-decoration: none;" href="index.html#footnote_9"><sup>[9]</sup></a>.





<div class='heading'>CIC internals</div><hr/><p>How the CIC internals were uncovered is a fascinating story which started in 2006 on forums.nesdev.org<a name="back_10" style="text-decoration: none;" href="index.html#footnote_10"><sup>[10]</sup></a>. In short, researchers gave up on the official Nintendo CIC to instead study Tengen's copy called "Rabbit". They discovered a debug function prompting the mammal to output its ROM on its pins. What we learn from this thread is that the CIC is a 4-bit SM590 microcontroller made by Sharp<a name="back_11" style="text-decoration: none;" href="index.html#footnote_11"><sup>[11]</sup></a>. It contains the following registers, RAM, and ROM.</p>

<pre> 
+-+         +-------+              +-------+-------+-------+-------+
|C|         |   A   |              |       |       |       |       |
+-+         +-+-+-+-+              +- - - - - - - - - - - - - - - -+
            |   X   |              |       |       |       |       |
        +---+-+-+-+-+              +- - - - - - - - - - - - - - - -+
        |     P     |              |       |       |       |       |
        | PH|   PL  |              +- - - - - - - - - - - - - - - -+
+-------+-+-+-+-+-+-+              |       |       |       |       |
|         IC        |              +- - - - - - - -R- - - - - - - -+
+-+-+-+-+-+-+-+-+-+-+              |       |       |       |       |
|                   |              +- - - - - - - - - - - - - - - -+
+- - - - - - - - - -+              |       |       |       |       |
|                   |              +- - - - - - - - - - - - - - - -+
+- - - - -S- - - - -+              |       |       |       |       |
|                   |              +- - - - - - - - - - - - - - - -+
+- - - - - - - - - -+              |       |       |       |       |
|                   |              +- - - - - - - - - - - - - - - -+
+-+-+-+-+-+-+-+-+-+-+
 
A  = 4-bit Accumulator                             R  = 32 nibbles of RAM
C  = Carry flag
X  = 4-bit General register
P  = Pointer for memory access
PH = Upper 2-bits of P
PL = Lower 4-bits of P, for I/O
IC = Instruction counter
S  = Stack for the IC register

</pre>
<p>There are also 512  bytes of ROM (768 for the 3195A, PAL version), where the instructions are stored<a name="back_12" style="text-decoration: none;" href="index.html#footnote_12"><sup>[12]</sup></a>.</p>

<p><b><u>Trivia:</u></b> The story of how the SNES CIC was understood is equally interesting<a name="back_13" style="text-decoration: none;" href="index.html#footnote_13"><sup>[13]</sup></a>.
</p>




<div class='heading'>Software Region lock (NTSC - PAL)</div><hr/><p>With all this knowledge, we can understand how Region lock worked. Nintendo simply used a different CIC ROM for their NA console and the European cartridge games. Different programs generated different signals which made the Lock CIC <code>HST RST</code> loop trigger.</p>

<p>How did people circumvent that region lock then? One solution was to pry open a Super Nintendo and operate on the Lock CIC. Since the lethal trigger was the <code>HST RST</code> pin, a solution was to severe it and disconnect it from the motherboard. That would have worked but that would have also disabled the RESET button of the machine.</p>

<p> A better solution was to cut the <code>CONF</code> pin<a name="back_14" style="text-decoration: none;" href="index.html#footnote_14"><sup>[14]</sup></a>. This made the Lock CIC behave like a Key CIC which never pulled the <code>HST RST</code> trigger.</p>

<img loading="lazy" src="cic_surgery_no_font.svg" width="489mm" height="146mm" style="width: 100%; height: auto; border:0; margin-bottom:2ch; "/>
<a href="adapter.webp">
<img loading="lazy" src="adapter.webp" width="1000" height="1000" style="width: 35%; height: auto; margin-bottom:2ch; float:right; margin-left:2ch;"/></a>

<p>Modding a console was too much to ask from most customers. Not only gamers didn't have the skills, such modification voided the warranty.</p>

<p> Instead adapters, called "Game Converter" started to appear. The device would connect in the cartridge slot of the console and allow two cartridges to be inserted on its top. In the front row the player placed the import game they wanted to play. In the back row, they plugged a cart belonging to same region as the console (e.g. Super Mario World).</p>

<p>The converter worked by discarding the import game four CIC lines. Instead it rerouted the local game cart CIC pins to the console. The result was a Lock CIC chatting with a Key CIC of a local game but the console running the import game.
</p>




<div class='heading'>Hardware Region lock (Japan - North America)</div><hr/><p>To make Japan cartridges incompatible with North American consoles (and vice versa), Nintendo went with a "budget" solution. The US cartridge have a rectangular form which does not fit in a Japan Super Famicom cartridge slot.</p>

<p>Super Famicom games on the other hand can go in a North American SNES but it cannot be pushed all the way down. Two rails on the side prevent it. See in the photo below how SNES games have grooves on each side to allow the rails to go up<a name="back_15" style="text-decoration: none;" href="index.html#footnote_15"><sup>[15]</sup></a>.</p>
</p>

<img loading="lazy" src="reg_hard.webp" width="1279" height="681" style="width: 100%; height: auto; margin-bottom:2ch;"/><span style="text-align: center; display: block; margin-bottom: 2ch;"><i><small>
Super Famicom (Japan) cart vs Super Nintendo (North America) cart. <a href="https://upload.wikimedia.org/wikipedia/commons/thumb/4/48/SNES-SFAM-Cartridges.jpg/">Image Source</a>
</small></i></span>

<p>These physical attributes are the only thing that prevent games cross-over between Japan and NA since the CIC chips are identical. All it took to defeat the "protection" was a screwdriver to remove a case (console or cart).</p>




<div class='heading'>Circumventing Licensing</div><hr/><p>Like the NES, the SNES had unlicensed games<a name="back_16" style="text-decoration: none;" href="index.html#footnote_16"><sup>[16]</sup></a> but it is unclear to me how they happened. Some publishers may have used Tengen's Rabbit. Others may have attempted to stun the CIC Lock on the console by driving a negative voltage spike<a name="back_17" style="text-decoration: none;" href="index.html#footnote_17"><sup>[17]</sup></a> on one of the four CIC pins connected to the cartridge. The latter is unlikely since the vulnerability was patched on the NES and likely on SNES too. Another mystery to solve someday....</p>

<style type='text/css'>td.ref {  padding-bottom: 0ch; width:0;}</style><div class='heading'>References</div><hr/><p id='paperbox' style='text-align:left;'><table><tbody style='vertical-align: top;'><tr><td class='ref' style='width:1ch;'><a name="footnote_1"></a><a href="index.html#back_1">^</a></td><td  class='ref' style='width:4ch;'> [ 1]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://fabiensanglard.net/cpsb_paper/">The Book of CP-Sytem</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_2"></a><a href="index.html#back_2">^</a></td><td  class='ref' style='width:4ch;'> [ 2]</td><td style='width:100%;text-align:left;' class='ref'><a href="Player&#32;One&#32;022&#32;-&#32;Page&#32;143.jpeg">Player One 022 - Page 143</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_3"></a><a href="index.html#back_3">^</a></td><td  class='ref' style='width:4ch;'> [ 3]</td><td style='width:100%;text-align:left;' class='ref'><a href="Player&#32;One&#32;022&#32;-&#32;Page&#32;040.jpeg">Player One 022 - Page 040</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_4"></a><a href="index.html#back_4">^</a></td><td  class='ref' style='width:4ch;'> [ 4]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://snescentral.com/chips.php?chiptype=CIC">SNES Central CIC article</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_5"></a><a href="index.html#back_5">^</a></td><td  class='ref' style='width:4ch;'> [ 5]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.nesdev.org/wiki/CIC_lockout_chip_pinout">CIC lockout chip pinout</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_6"></a><a href="index.html#back_6">^</a></td><td  class='ref' style='width:4ch;'> [ 6]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://github.com/Neo-Desktop/SNES-CIC-Disassembly/tree/master/dissassembly">SNES-CIC-Disassembly</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_7"></a><a href="index.html#back_7">^</a></td><td  class='ref' style='width:4ch;'> [ 7]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://hackmii.com/2010/01/the-weird-and-wonderful-cic/">The weird and wonderful CIC</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_8"></a><a href="index.html#back_8">^</a></td><td  class='ref' style='width:4ch;'> [ 8]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://hackmii.com/2010/01/the-weird-and-wonderful-cic/">The weird and wonderful CIC</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_9"></a><a href="index.html#back_9">^</a></td><td  class='ref' style='width:4ch;'> [ 9]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://hackmii.com/2010/01/the-weird-and-wonderful-cic/">The weird and wonderful CIC</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_10"></a><a href="index.html#back_10">^</a></td><td  class='ref' style='width:4ch;'> [10]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://forums.nesdev.org/viewtopic.php?t=1219">Reverse Engineering the CIC</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_11"></a><a href="index.html#back_11">^</a></td><td  class='ref' style='width:4ch;'> [11]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://en.wikipedia.org/wiki/CIC_(Nintendo)">CIC (Nintendo): Design section</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_12"></a><a href="index.html#back_12">^</a></td><td  class='ref' style='width:4ch;'> [12]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.nesdev.org/wiki/CIC_lockout_chip_pinout">CIC lockout chip pinout</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_13"></a><a href="index.html#back_13">^</a></td><td  class='ref' style='width:4ch;'> [13]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://forums.nesdev.org/viewtopic.php?t=5676">What happened with SNES CIC reverse engineering?</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_14"></a><a href="index.html#back_14">^</a></td><td  class='ref' style='width:4ch;'> [14]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://youtu.be/LLMCj2VosLc?t=510">Disable the 10NES chip in your NES</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_15"></a><a href="index.html#back_15">^</a></td><td  class='ref' style='width:4ch;'> [15]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.youtube.com/watch?v=NgEr1kukqjI&t=472s">How to play Japanese SNES/Super Famicom games in America/USA</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_16"></a><a href="index.html#back_16">^</a></td><td  class='ref' style='width:4ch;'> [16]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://tcrf.net/Category:Unlicensed_SNES_games">Unlicensed SNES games</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_17"></a><a href="index.html#back_17">^</a></td><td  class='ref' style='width:4ch;'> [17]</td><td style='width:100%;text-align:left;' class='ref'><a href="http://www.kevtris.org/mappers/lockout/">Kevin Horton's 'The Infamous Lockout Chip'</a></td></tr></tbody></table></p> <hr>
 <center>*