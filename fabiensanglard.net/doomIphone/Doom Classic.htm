<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0100)http://web.archive.org/web/20110725100250/http://www.idsoftware.com/doom-classic/doomdevelopment.htm -->
<html xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from www.idsoftware.com/doom-classic/doomdevelopment.htm by HTTrack Website Copier/3.x [XR&CO'2010], Thu, 16 Jun 2011 16:37:44 GMT --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Doom Classic</title>
<link href="Doom&#32;Classic_files/doomdev.css" rel="stylesheet" type="text/css">
<style type="text/css">
<!--
.style2 {font-size: 12px}
-->
</style>
</head>
<body>


<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>



<div class="siteWrap"> 
  <div align="justify">

    <h2 align="center"><a href="http://web.archive.org/web/20110725100250/http://www.idsoftware.com/doom-classic/index.htm"><img src="Doom&#32;Classic_files/doomclassicicon_sm.png" border="0"></a></h2>
    <h2>Development on Doom Classic<br>
    <span class="style2">By John Carmack, Technical Director, Id Software</span></h2>
    <img src="Doom&#32;Classic_files/carmack-phone.png" style="float:left;padding:10px;"><p>Way back in March when I released the source for  Wolfenstein 3D Classic, I said that Doom Classic would be coming "real  soon", and on April 27, I gave a progress report: <br>
      <a href="http://web.archive.org/web/20110725100250/http://www.idsoftware.com/iphone-doom-classic-progress/index.html">http://www.idsoftware.com/iphone-doom-classic-progress/</a><br>
I spent a while getting the multiplayer functionality up,  and I figured I only had to spend a couple days more to polish things up for  release.&nbsp; </p>
    <p>      However, we were finishing up the big iPhone Doom Resurrection  project with Escalation Studios, and we didn't want to have two Doom games  released right on top of each other, so I put Doom Classic aside for a  while.&nbsp; After Doom Resurrection had its  time in the sun, I was prepared to put the rest of the work into Doom Classic,  but we ran into another schedule conflict.&nbsp;  As I related in my Wolf Classic notes <a href="http://web.archive.org/web/20110725100250/http://www.idsoftware.com/wolfenstein-3d-classic-platinum/wolfdevelopment.htm">http://www.idsoftware.com/wolfenstein-3d-classic-platinum/wolfdevelopment.htm</a> , Wolfenstein RPG for the iPhone was actually done before Wolfenstein Classic,  but EA had decided to sit on it until the release of the big PC / console  Wolfenstein game in August.</p>
    <p>      I really thought I was going to go back and finish things  up in September, but I got crushingly busy on other fronts.&nbsp; In an odd little bit of serendipity, after  re-immersing myself in the original Doom for the iPhone, I am now working  downstairs at Id with the Doom 4 team.&nbsp;  I'm calling my time a 50/50 split between Rage and Doom 4, but the  stress doesn't divide.&nbsp; September was  also the month that Armadillo Aerospace flew the level 2 Lunar Lander  Challenge: </p>
    <p><a href="http://web.archive.org/web/20110725100250/http://www.armadilloaerospace.com/n.x/Armadillo/Home/News?news_id=368">http://www.armadilloaerospace.com/n.x/Armadillo/Home/News?news_id=368</a></p>
    <p>      Finally, in October I SWORE I would finish it, and we  aimed for a Halloween release.&nbsp; We got it  submitted in plenty of time, but we ran into a couple approval hiccups that  caused it to run to the very last minute.&nbsp;  The first was someone incorrectly thinking that the "Demos"  button that played back recorded demos from the game, was somehow providing  demo content for other commercial products, which is prohibited.&nbsp; The second issue was the use of an iPhone  image in the multiplayer button, which we had to make a last minute patch for.</p>
    <h2>Release notes</h2>
    <p>      Ok, the game is finally out (the GPL source code is being  packaged up for release today).&nbsp; Based on  some review comments, there are a couple clarifications to be made:</p>
    <p>      Multiplayer requires a WiFi connection that doesn't have  UDP port 14666 blocked.&nbsp; I'm quite happy  with the simple and fast multiplayer setup, but it seems like many access  points just dump the packets in the trash.&nbsp;  If the multiplayer button on the main menu doesn't start pulsing for  additional players after the first player has hit it, you won't be able to  connect.&nbsp; I have also seen a network  where the button would pulse, but the player would never get added to the  player list, which meant that somehow the DNS packets were getting through, but  the app packets weren't.&nbsp; It works fine  on a normal AirPort install...&nbsp; More on  networking below.</p>
    <p>      I took out tilt-to-turn just to free up some interface  screen space, because I didn't know anyone that liked that mode, and my query  thread on Touch Arcade didn't turn up people that would miss it a lot.&nbsp; </p>
    <p>      Evidently there are a few people that do care a lot, so  we will cram that back in on the next update.&nbsp;  The functionality is still there without a user interface, so you can  enable it by four-finger-tapping to bring up the keyboard and typing  "tiltturn 4000" or some number like that, and it will stay set.&nbsp; Make sure you have tiltmove pulled down to  0.&nbsp; I never got around to putting in a  real console, but you can change a few parameters like that, as well as enter  all the original doom cheat codes like IDDQD, IDKFA, etc. </p>
    <p>      I think that the auto-centering control sticks in Doom  Classic are a better control scheme than the fixed sticks from Wolf  Classic.&nbsp; The advice for wolf was to  adjust the stick positions so that your thumbs naturally fell in the center  point, so I just made that automatic for Doom.&nbsp;  Effective control always involved sliding your thumbs on the screen,  rather than discretely tapping it, and this mode forces you to do that from the  beginning.<br>
      Still, even if the new mode is some fraction  "better", there are a lot of people who have logged a lot of hours in  Wolfenstein Classic, and any change at all will be a negative initially.&nbsp; In the options-&gt;settings menu screen,  there is a button labeled "Center sticks: ON" that can be toggled off  to keep the sticks fixed in place like in Wolf.</p>
    <p>      A subtle difference is that the turning sensitivity is  now graded so that a given small movement will result in a specific percentage  increase in speed, no matter where in the movement range it is.&nbsp; With linear sensitivity, if you are 10 pixels  off from the center and you move your thumb 10 pixels farther, then the speed  exactly doubles.&nbsp; If you are 50 pixels  off from the center, the same 10 pixel move only increases your turning rate by  20%.&nbsp; With ramped sensitivity, you would  get a 20% (depending on the sensitivity scale) increase in speed in both cases,  which tends to be better for most people.&nbsp;  You can disable this by toggling the "Ramp turn: ON" option  off.</p>
    <p>In hindsight, I should have had a nice obvious button on  the main options screen that said "Wolfenstein Style" and had the  same options, but I have always had difficult motivating myself to do good  backwards compatibility engineering.&nbsp;  Even then, the movement speeds are different between the games, so it  wouldn't have felt exactly the same.</p>
    <p>It was a lot of fun to do this project, working on it  essentially alone, as a contrast to the big teams on the major internal  projects.&nbsp; I was still quite pleased with  how the look and feel of the game holds up after so long, especially the  "base style" levels.&nbsp; The  "hell levels" show their age a lot more, where the designers were  really reaching beyond what the technology could effectively provide.</p>
    <h2>Future iPhone work</h2>
    <p>      We do read all the reviews in the App store, and we do  plan on supporting Doom Classic with updates.&nbsp;  Everything is still an experiment for us on the iPhone, and we are  learning lessons with each product.&nbsp; At  this point, we do not plan on making free lite versions of future products,  since we didn't notice anything worth the effort with Wolfenstein, and other  developers have reported similar findings.</p>
    <p>      We have two people at Id that are going to be dedicated  to iPhone work.&nbsp; I doubt I will be able  to personally open Xcode again for a few months, but I do plan on trying to  work out a good touch interface for Quake Classic and the later 6DOF  games.&nbsp; I also very much want to make at  least a tech demo that can run media created with a version of our idTech 5  megatexture content creation pipeline.&nbsp;  I'm not sure exactly what game I would like to do with it, so it might  be a 500 mb free gee-whiz app...</p>
    <p>      Wolfenstein Classic Platinum was a break-in opportunity  for the new internal iPhone developers.&nbsp;  We were originally planning on making the Spear of Destiny levels  available as in-app purchased content.&nbsp;  Then we decided to make it a separate "Platinum Edition"  application at a reasonable price.&nbsp;  Finally, we decided that we would just make it a free update, but  something has gone wrong during this process -- people who buy the app for the  first time get everything working properly, but many people who upgrade the App  from a previous purchase are seeing lots of things horribly broken.&nbsp; We are working with Apple to try to debug and  fix this, but the workaround is to uninstall the app completely, then reload  it.&nbsp; The exciting thing about Wolf  Platinum is the support for downloadable levels, which is the beta test for  future game capabilities.&nbsp; Using a URL to  specify downloadable content for apps is a very clean way to interface to the  game through a web page or email message.</p>
    <p>      The idMobile team is finishing up the last of the BREW  versions of Doom 2 RPG, and work has started on an iPhone specific version,  similar to the Wolfenstein RPG release.&nbsp;  The real-time FPS games are never going to be enjoyable for a lot of  people, and the turn based RPG games are pretty neat in many regards. &nbsp;If they are well received, we will probably  bring over the Orcs&amp;Elves games as well.</p>
    <p>      I want to work on a Rage themed game to coincide with  Rage's release, but we don't have a firm direction or team chosen for it.&nbsp; I was very excited about doing a  really-designed-for-the-iPhone first person shooter, but at this point I am  positive that I don't have the time available for it.</p>
    <h2>      Networking techie stuff</h2>
    <p>      I doubt one customer in ten will actually play a network  game of Doom Classic, but it was interesting working on it.</p>
    <p>      Way back in March when I was first starting the work, I  didn't want the game to require 3.0 to run, and I generally try to work with  the lowest level interfaces possible for performance critical systems, so I  wasn't looking at GameKit for multiplayer.&nbsp;  I was hoping that it was possible to use BSD sockets to allow both WiFi  networking on 2.0 devices and WiFi or ad-hoc bluetooth on 3.0 devices.&nbsp; It turns out that it is possible, but it  wasn't documented as such anywhere I could find.<br>
      I very much approve of Apple's strategy of layering Obj-C  frameworks on top of Unix style C interfaces.&nbsp;  Bonjour is a layer over DNS, and GameKit uses sockets internally.&nbsp; The only bit of obscure magic that goes on is  that the bluetooth IP interface only comes into existence after you have asked  DNS to resolve a service that was reported for it.&nbsp; Given this, there is no getting around using  DNS for initial setup.&nbsp; </p>
    <p>      With WiFi, you could still use your own broadcast packets  to do player finding and stay completely within the base sockets interfaces,  and this might even make some sense, considering that there appear to be some  WiFi access points that will report a DNS service's existence that your app  can't actually talk to.<br>
      For every platform I have done networking on previously,  you could pretty much just assume that you had the loopback interface and an Ethernet  interface, and you could just use INADDR_ANY for pretty much everything.&nbsp; Multiple interfaces used to just be an issue  for big servers, but the iPhone can have a lot of active interfaces --  loopback, WiFi Ethernet, Bluetooth Ethernet, and several point to point  interfaces for the cellular data networks.</p>
    <p>      At first, I was excited about the possibility of  multiplayer over 3G.&nbsp; I had been told by  someone at Intel that they were seeing ping times of 180 ms on 3G devices,  which could certainly be made to work for gaming.&nbsp; </p>
    <p>      Unfortunately, my tests, here in Dallas at least, show  about twice that, which isn't worth fighting.&nbsp;  I'm a bit curious whether they were mistaking one-way times, or if the  infrastructure in California is really that much better.&nbsp; In any case, that made my implementation  choice clear -- local link networking only.</p>
    <p>      A historical curiosity: the very first release of the  original Doom game on the PC used broadcast IPX packets for LAN  networking.&nbsp; This seemed logical, because  broadcast packets for a network game of N players has a packet count of just N  packets on the network each tic, since everyone hears each packet.&nbsp; The night after we released the game, I was  woken up by a call from a college sysadmin yelling at me for crippling their  entire network.&nbsp; I didn't have an  unlisted number at the time.&nbsp; When I had  decided to implement network gaming, I bought and read a few books, but I  didn't have any practical experience, so I had thought that large networks were  done like the books explained, with routers connecting independent  segments.&nbsp; I had no idea that there were  many networks with thousands of nodes connected solely by bridges that  forwarded all broadcast packets over lower bit rate links.&nbsp; I quickly changed the networking to have each  peer send addressed packets to the other peers.&nbsp;  More traffic on the local segment, but no chance of doing horrible  things to bridged networks.</p>
    <p>      WiFi is different from wired Ethernet in a few ways.&nbsp; WiFi clients don't actually talk directly to  each other, they talk to the access point, which rebroadcasts the packet to the  destination, so every packet sent between two WiFi devices is actually at least  two packets over the air.&nbsp; </p>
    <p>      An ad-hoc WiFi network would have twice the available  peer to peer bandwidth and half the packet drop rate that an access point based  one does.&nbsp; Another point is that unlike  wired Ethernet, the WiFi link level actually does packet retransmits if the  destination doesn't acknowledge receipt.&nbsp;  They won't be retransmitted forever, and the buffer spaces are limited,  so it can't be relied upon the way you do TCP, but packet drops are more rare  than you would expect.&nbsp; This also means  that there are lots of tiny little ACK packets flying around, which contributes  to reduced throughput.&nbsp; Broadcast packets  are in-between -- the broadcast packet is sent from the source to the access  point with acknowledgment and retransmits, but since the access point can't  know who it is going to, it just fires it out blind a single time.</p>
    <p>      I experimentally brought the iPhone networking up initially  using UDP broadcast packets, but the delivery was incredibly poor.&nbsp; Very few packets were dropped, but hundreds  of milliseconds could sometimes go by with no deliveries, then a huge batch  would be delivered all at once.&nbsp; I  thought it might be a policy decision on our congested office access point, but  it behaved the same way at my house on a quiet LAN, so I suspect there is an  iPhone system software issue.&nbsp; If I had a  bit more time, I would have done comparisons with a WiFi laptop.&nbsp; I had pretty much planned to use addressed  packets anyway, but the broadcast behavior was interesting.</p>
    <p>      Doom PC was truly peer to peer, and each client  transmitted to every other client, for N * (N-1) packets every tic.&nbsp; It also stalled until valid data had arrived  from every other player, so adding more players hurts in two different ways --  more packets = more congestion = more likely to drop each individual  packet.&nbsp; The plus side of an arrangement  like this is that it is truly fair, no client has any advantage over any other,  even if one or more players are connected by a lower quality link.&nbsp; Everyone gets the worst common denominator  behavior.</p>
    <p>      I settled on a packet server approach for the iPhone,  since someone had to be designated a "server" anyway for DNS  discovery, and it has the minimum non-broadcast packet count of 2N packets  every tic.&nbsp; Each client sends a command  packet to the server each tic, the server combines all of them, then sends an  addressed packet back to each client.&nbsp;  The remaining question was what the server should do when it hasn't  received an updated command from a client.&nbsp;  When the server refused to send out a packet until it had received data  from all clients, there was a lot more variability in the arrival rate.&nbsp; It could be masked by intentionally adding  some latency on each client side, but I found that it plays better to just have  the server repeat the last valid command when it hasn't gotten an update.&nbsp; This does mean that there is a slight  performance advantage to being the server, because you will never drop an  internal packet.</p>
    <p>      The client always stalls until it receives a server  packet, there was no way I had the time to develop any latency reducing / drop  mitigating prediction mechanisms.&nbsp; There  are a couple full client / server, internet capable versions of Doom available  on the PC, but I wanted to work from a more traditional codebase for this  project.</p>
    <p>      So, I had the game playing well over WiFi, but  communication over the Bluetooth interface was significantly worse.&nbsp; There was an entire frame of additional  latency versus WiFi, and the user mode Bluetooth daemon was also sucking up 10%  of the CPU.&nbsp; That would have been  livable, but there were regular surges in the packet delivery rate that made it  basically unplayable.</p>
    <p>      Surging implies a buffer somewhere backing up and then  draining, and I had seen something similar but less damaging occasionally on  WiFi as well, so I wondered if there might be some iPhone system communication  going on.&nbsp; I spent a little while with  WireShark trying to see if the occasional latency pileup was due to actual  congestion, and what was in the packets, but I couldn't get my Macbook into  promiscuous WiFi mode, and I didn't have the time to configure a completely new  system.</p>
    <p>      In the end, I decided to just cut out the Bluetooth networking  and leave it with WiFi.&nbsp; There was a  geek-neatness to having a net game with one client on WiFi and another on  Bluetooth, but I wasn't going to have time to wring it all out.</p>
    <p><br>
    </p>
    <p></p>
  </div>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://web.archive.org/web/20110725100250/http://www/");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="Doom&#32;Classic_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-3677089-4");
pageTracker._trackPageview();
} catch(err) {}</script>

<!-- Start Quantcast tag -->
<script type="text/javascript">
_qoptions={
qacct:"p-3eK2SF53G6Wa6"
};
</script>
<script type="text/javascript" src="Doom&#32;Classic_files/quant.js"></script>
<noscript>
&lt;img src="http://web.archive.org/web/20110725100250im_/http://www.idsoftware.com/pixel.quantserve.com/pixel/p-3eK2SF53G6Wa6.gif" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/&gt;
</noscript>
<!-- End Quantcast tag -->


<!-- Mirrored from www.idsoftware.com/doom-classic/doomdevelopment.htm by HTTrack Website Copier/3.x [XR&CO'2010], Thu, 16 Jun 2011 16:37:44 GMT -->






<!--
     FILE ARCHIVED ON 10:02:50 Jul 25, 2011 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 23:33:11 Sep 5, 2012.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
</body></html>