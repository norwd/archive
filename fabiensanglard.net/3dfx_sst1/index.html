<html>
<head>
  <link rel="alternate" type="application/rss+xml"  title="RSS Feed for fabiensanglard.net" href="../rss.xml" />
  <style type="text/css">

    @font-face {
      font-family: 'fabfont';
      src: url('../font/DejaVuSansMono.woff2');
      font-display: block;
    }

    @font-face {
      font-family: 'fabfont';
      src: url('../font/DejaVuSansMono-Bold.woff2');
      font-weight: bold;
      font-display: block;
    }

    * {
       font-size: 16px;
    }

    html {
      font-family: fabfont,  monospace;
      max-width: 900px;  /* For Desktop PC (see @media for Tablets/Phones) */
      padding-left: 2%;
      padding-right: 3%;
      margin: 0 auto;
      background: #F5F5F0;
  	} 
    


  	a {
      color: black;
      font-weight: bold;
    }

    img {
      border: none; 
    }

    p {
      margin-top: 0px;
      text-align: justify;
    }
    sup {
      vertical-align: 0.3em;
      font-size: 0.65em;
    }   

    pre {
      font-family: fabfont, monospace;
      background-color: white; 
      border: 1px solid Black; 
      padding-left: 2%;
      padding-top: 1ch;
      padding-bottom: 1ch;
      /* Only take care of X overflow since this is the only part that can be too wide.
         The Y axis will never overflow.
      */
      overflow: hidden;
    }

    div.heading {
      font-weight: bold;      
      text-transform: uppercase;
      margin-top: 4ch;
    }

    /** {
      font-size: 16px;
    }*/
    @media (max-width: 500px) { /* For small screen decices */
      * {
        font-size: 12px; 
      }
    }   
    .title {
      text-decoration: none;
    }

    img.pixel, canvas.pixel {
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }

    blockquote { 
    background-color: #f3f3f3;
    border: dashed 1px grey; 
    width: 97.5%; 
    font-style: italic; 
    text-align: justify;

    padding: 1ch; 
    padding-top: 2ch; 
    padding-bottom: 2ch;     
    
    margin : 0ch; 
    margin-bottom: 2ch; 
    margin-top: 0ch;
  }

  blockquote div {
    text-transform: none;
    text-align: right;
    width: 100%;
  }

  code {
    /*font-size: 110%;*/
    font-weight: bold;
    background-color: #e1e1e1;
    border-radius: 0.5ch;
    padding-left: 0.3ch;
    padding-right: 0.3ch;
  }

  .trivia {
    border-left: 1px black solid;
    padding-left: 1ch;
  }

  .trivia::before {
  font-weight: bold;
  text-decoration: underline;
  padding-right: 1ch;
  content: "Trivia:";

  </style>
  <title>The story of the 3dfx Voodoo1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=12.0, minimum-scale=1.0, user-scalable=yes">
</head>  
  <body><br><center>
    <div style="display: inline-block; vertical-align:middle;">
<a href="../index.html" class="title"><b>FABIEN SANGLARD'S WEBSITE</b><br>
</a><hr/><div style="text-align: justify;display: inline-block; width: 100%;">
<!-- <a class="title" href="/about/index.html">ABOUT</a> &nbsp;<a class="title" href="/contact/index.html">EMAIL</a> &nbsp;<a class="title" href="../rss.xml">RSS</a> &nbsp;<a class="title" href="https://paypal.me/fabiensanglard">DONATE</a></div></div> -->
<a class="title" href="../about/index.html">ABOUT</a> &nbsp;<a class="title" href="../contact/index.html">CONTACT</a> &nbsp;<a class="title" href="../rss.xml">RSS</a> &nbsp;<a class="title" href="https://paypal.me/fabiensanglard">GIVE</a></div></div>

</center><br><br>
<div style="margin-bottom: 2ch;text-transform: none;">
April 4, 2019</div>
<div class='heading'>The story of the 3dfx Voodoo1</div><hr/>
<p>
<img loading="lazy" src="3dfx_logo.svg" width="937" height="768" style="width: 23%; height: auto; float:right;margin-bottom: 1ch; margin-left: 2ch;"/>This article is the second entry in a series about the "3D cards of the late 90s running Quake". The first entry<a name="back_1" style="text-decoration: none;" href="index.html#footnote_1"><sup>[1]</sup></a> took a look at the end of 1996 with the Rendition V&eacute;rit&eacute; 1000 and its dedicated port called vQuake. Rendition had managed to beat everybody to Quake-market. For a brief period of time they had the one and only board capable of running id Software's blockbuster with hardware-acceleration.<br/>
<br/>
 Everything changed on January 1997, when id Software released a new version of Quake called GLQuake. Because the port was done using miniGL (a subset of OpenGL 1.1 standard), any hardware-accelerator manufacturer could provide miniGL drivers and enter the 3D race. From that point onward, the competition would be open to everybody. The goal was to generate as many frames per second as possible. The rewards were fame and customer's money. A brief search revealed that the two authorities of the time were unambiguous about who was at the top of the mountain.

  <blockquote>
All in all there's currently hardly any doubt about it, Voodoo rules the Quake world. Now since Quake rules the gaming world, 3Dfx Voodoo is pretty much unavoidable for any gamer.<br/>
<br/>
<div>- Tom's Hardware November 30, 1997v</div>
</blockquote> 

  <blockquote >
3DFX Voodoo 1<br/>
-------------<br/>
The benchmark against which everything else is measured.<br/>
<br/>
<div>- John Carmack .plan. Feb 12, 1998<a name="back_2" style="text-decoration: none;" href="index.html#footnote_2"><sup>[2]</sup></a></div>
</blockquote>

<p>
After a first peek at the specs<a name="back_3" style="text-decoration: none;" href="index.html#footnote_3"><sup>[3]</sup></a> claiming a 50 Mpixels/second fillrate figure, I was eager to fully immerse into it and find out what 3dfx had done to produce such an indisputable powerhouse.<br/>
</p>
<div style="clear:both;"></div>
 



<div class='heading'>3dfx Interactive</div><hr/><p>
  Ross Smith, Scott Sellers, and Gary Tarolli originally met while working at SGI<a name="back_4" style="text-decoration: none;" href="index.html#footnote_4"><sup>[4]</sup></a>.
  After a short stint at Pellucid where they tried to sell IrisVision boards for PC (at 1994 $4,000/piece), they started their own company with backing from Gordie Campbell's TechFarm. Headquartered in San Jose, California, 3dfx Interactive was founded in 1994.<br/>
  <br/>
  Initially intending to design powerful hardware solutions for arcade games, 3dfx pivoted in order to design PC add-on boards. There were three reasons for that.
  <ol>
  <li>The price of RAM was low enough.</li>
  <li>Starting with FastPage RAM and then with EDO RAM, the latency of RAM had improved 30%. It could now be clocked at up to 50Mhz.</li>
  <li>3D (or pseudo-3D) games were becoming more and more popular. Success of titles such as DOOM, Descent, and Wing Commander III showed that a market for 3D acceleration cards was about to emerge.</li>
  </ol>
  <p>
   They figured they could design something powerful, dedicated to games, and retailing in the $300-$400 range. In 1996 the company announced the SST1 (named after the founders Sellers-Smith-Tarolli-1) architecture which was promptly licensed by several OEMs such as Diamond, Canopus, Innovision, and ColorMAX. The marketing name given to their creation was "Voodoo1" for its magic like performance properties.<br/>
   <br/>
   Like with the V1000, OEM's only leverage on the cards they produced was the RAM they selected (EDO vs DRAM), the color of the resin and the physical layout of the chips. Pretty much everything else was standardized.
</p>
<picture  style="margin-top: 0ch;">
    <source srcset="voodoo1diamfb.webp" type="image/webp">
    <img loading="lazy" src="voodoo1diamfb.png" width="2854" height="1660" style="width: 100%; height: auto; margin: 0; margin-top: 0ch;"/></picture>
<center style="margin-top: 1ch;"><i>Diamond Monster 3D, courtesy of vgamuseum.info.</i></center><br/>

<picture>
    <source srcset="voodoo1canopusfb.webp" type="image/webp">
    <img loading="lazy" src="voodoo1canopusfb.png" width="1600" height="902" style="width: 100%; height: auto; margin: 0; margin-top: 2ch;"/></picture>
<center style="margin-top: 1ch;"><i>Canopus Pure3D, courtesy of vgamuseum.info.</i></center><br/>

<picture>
    <source srcset="biostar_venus_3d_graphics_rev.1.0_top_hq.webp" type="image/webp">
    <img loading="lazy" src="biostar_venus_3d_graphics_rev.1.0_top_hq.png" width="1600" height="892" style="width: 100%; height: auto; margin: 0; margin-top: 2ch;"/></picture>
<center style="margin-top: 1ch;"><i>BIOSTAR Venus 3D, courtesy of vgamuseum.info.</i></center><br/>

<picture>
    <source srcset="537_orchid_righteous_3d_3dfx_voodoo1_top_hq.webp" type="image/webp">
    <img loading="lazy" src="537_orchid_righteous_3d_3dfx_voodoo1_top_hq.png" width="1600" height="986" style="width: 100%; height: auto; margin: 0; margin-top: 2ch;"/></picture>
<center style="margin-top: 1ch;margin-bottom: 2ch;"><i>ORCHID Righteous 3D, courtesy of vgamuseum.info.</i></center><br/>
<p>
<img loading="lazy" src="sst1_drawing.svg" width="200.53905mm" height="129.58032mm" style="width: 40%; height: auto; float:right;margin-bottom: 1ch; margin-left: 2ch;"/>
  What is mesmerizing when taking a look at an SST1 board are the divergences from its competitors, the Rendition V&eacute;rit&eacute; 1000 and the NVidia NV1.<br/>
  <br/>
  First of all, 3dfx had made the audacious choice to not support 2D rendering. The Voodoo1 had two VGA ports, one acting as output and the other as input. The card was designed as an add-on which took as input the output of the 2D VGA card already installed in a PC. When the user was running the operating system (DOS or Windows), the Voodoo1 was just a pass-through which did nothing but to relay the signal from its VGA input to its VGA output. When entering 3D mode, the Voodoo1 took over the VGA output port and discarded the signal on its VGA input. Some boards had a mechanical switch which would generate an audible "click" when switching between 2D and 3D mode. This choice also meant the card could only do fullscreen rendition, there was no "windowed" mode.<br/>
  <br/>
  The second remarkable aspect of the SST1 is that it was made of not one CPU but two non-programmable ASICs (Application-Specific Integrated Circuit). If you follow the bus lines, you can see that each chip, labeled "TMU" and "FBI", had its own RAM. On a 4MiB card, the RAM was divided equally with 2MiB for the TMU to store textures and 2MiB for the FBI to store the color and z buffer where values were stored respectively as 16-bit RGBA and 16-bit integer/half-float. A 4MiB card supported a resolution up to 640x480 (2 color buffer (640x480x2) for double-buffering + 1 depth buffer (640x480x2) = 1,843,200). Later models with 4MiB FBI RAM allowed up to 800x600 (2x800x600x2 + 800x600x2 = 2,880,000).
</p> 

<div class='heading'>The SST1 Rendering pipeline</div><hr/><p>
  The pipeline is not explicitly detailed in the specs. My interpretation is that the life of a triangle is made of five stages.
</p>
<img loading="lazy" src="sst1_pipeline.svg" width="200.33746mm" height="194.02779mm" style="width: 40%; height: auto; float:right;margin-bottom: 1ch; margin-left: 2ch;"/>  <ol style="text-align: justify;">
    <li>A triangle is created and transformed on the computer's main CPU (usually a Pentium). These operations include modelview/projection multiplication matrix, culling, per-vertex perspective-divide, homogeneous coordinate clipping, and view port transform. At the end of the process, all what remains are visible screenspace triangles (because of clipping, one triangle can result in two sub-triangles).</li>
    <li>Triangles are sent to the Frame Buffer Interface (a.k.a FBI) via a triangleCMD command over the PCI bus. They are converted to scanline requests issued to the Texture Mapping Unit. For each scanline element (called fragment), the TMU performs up to four texture lookups per pixel when bilinear filtering is required by the developer.  Per-fragment perspective-divide is also done in the TMU.</li>
    <li>The TMU sends fragments to the FBI as textured 16-bit RGBA color value + a 16-bit z-value.</li>  
    <li>The FBI performs fragment z-buffer tests against its dedicated RAM storing the framebuffer RGBA and z values.</li>
    <li>Lastly, a fragment is lit via its color attribute and a 64-entry fog lookup. If blending is requested, the FBI combines the incoming fragment with what was already in the color buffer.  
  </ol>
  <p>
    <b>Trivia:</b> If you are a 3D enthusiast you probably know about the fast inverse square root code popularized by Quake 3 source code:
</p>

<pre style="color:#000000;background:#ffffff;"><span style="color:#800000; font-weight:bold; ">float</span> Q_rsqrt<span style="color:#808030; ">(</span><span style="color:#800000; font-weight:bold; ">float</span> number<span style="color:#808030; ">)</span> <span style="color:#800080; ">{</span>
    <span style="color:#800000; font-weight:bold; ">long</span> i<span style="color:#800080; ">;</span>
    <span style="color:#800000; font-weight:bold; ">float</span> x2<span style="color:#808030; ">,</span> y<span style="color:#800080; ">;</span>
    <span style="color:#800000; font-weight:bold; ">const</span> <span style="color:#800000; font-weight:bold; ">float</span> threehalfs <span style="color:#808030; ">=</span> <span style="color:#008000; ">1.5</span><span style="color:#006600; ">f</span><span style="color:#800080; ">;</span>

    x2 <span style="color:#808030; ">=</span> number <span style="color:#808030; ">*</span> <span style="color:#008000; ">0.5</span><span style="color:#006600; ">f</span><span style="color:#800080; ">;</span>
    y  <span style="color:#808030; ">=</span> number<span style="color:#800080; ">;</span>
    i  <span style="color:#808030; ">=</span> <span style="color:#808030; ">*</span> <span style="color:#808030; ">(</span><span style="color:#800000; font-weight:bold; ">long</span><span style="color:#808030; ">*</span><span style="color:#808030; ">)</span> <span style="color:#808030; ">&amp;</span>y<span style="color:#800080; ">;</span>    <span style="color:#696969; ">// evil floating point bit level hacking</span>
    i  <span style="color:#808030; ">=</span> <span style="color:#008000; ">0x5f3759df</span> <span style="color:#808030; ">-</span> <span style="color:#808030; ">(</span> i <span style="color:#808030; ">&gt;</span><span style="color:#808030; ">&gt;</span> <span style="color:#008c00; ">1</span> <span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>                <span style="color:#696969; ">// what the fuck? </span>
    y  <span style="color:#808030; ">=</span> <span style="color:#808030; ">*</span> <span style="color:#808030; ">(</span> <span style="color:#800000; font-weight:bold; ">float</span> <span style="color:#808030; ">*</span> <span style="color:#808030; ">)</span> <span style="color:#808030; ">&amp;</span>i<span style="color:#800080; ">;</span>
    y  <span style="color:#808030; ">=</span> y <span style="color:#808030; ">*</span> <span style="color:#808030; ">(</span> threehalfs <span style="color:#808030; ">-</span> <span style="color:#808030; ">(</span> x2 <span style="color:#808030; ">*</span> y <span style="color:#808030; ">*</span> y <span style="color:#808030; ">)</span> <span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>     <span style="color:#696969; ">// 1st iteration</span>
    <span style="color:#800000; font-weight:bold; ">return</span> y<span style="color:#800080; ">;</span>
<span style="color:#800080; ">}</span>
</pre>

<p>
In his quest<a name="back_5" style="text-decoration: none;" href="index.html#footnote_5"><sup>[5]</sup></a> to find out the origin of Q_rsqrt, Rys Sommefeldt got in touch with  Gary Tarolli who mentioned having used the code since his days at SGI. It is fair to assume the trick was also used in the SST1 pipeline.
  </p>

<div class='heading'>Does not compute</div><hr/><p>
  With the pipeline in mind and knowing that every component (TMU, FBI, EDO RAM) was clocked at 50Mhz<!-- , a pixel had to be generated every 20ns. I -->, it is obvious that the math does not add up to reach 50 MPixel/second. There were two problems to solve here.<br/>
  <br/>
  First, the TMU unit had to read four texels to perform bilinear filtering on a texture. This means four round trips to the RAM which would have resulted in TMU starvation and 50/4 = 12.5MPixel/s fillrate.<br/>
  <br/>
  There is a second choke point at the FBI level. If z-buffer testing is enabled, an incoming fragment z value needs to be compared to what is already in the z-buffer before either writing or discarding it. If the test succeed, the value needs to be written. These are two RAM operations which should have resulted in an halved 50/2= 25 MPixel/s.
</p>

<div class='heading'>TMU 4-way interleave</div><hr/><p style="margin-bottom: 2ch;">
  The solution to the four samples problem in the TMU stage is mentioned in the SST1 specs.

<blockquote>
  The texture memory datapath is
fully interleaved, which allows an individual bank to access data irrespective of the address used to access data in
other banks.<br/>
<br/>
<div>- SST1 specs</div>
</blockquote>
<p>

It is not specified if the bus used address multiplexing or if the data and address lines were shared. Drawing it non-multiplex and non-shared makes things easier to understand.<br/>
<br/>
<img loading="lazy" src="tmu_4_ways.svg" width="318.22894mm" height="106.71651mm" style="width: 100%; height: auto; margin:0;margin-bottom:2ch;"/><br/>
Regardless of the details, the TMU architecture allowed it to retrieve 4 x 16-bit texels per clock. With the inputs coming at the correct rate, the TMU was able to perform per-fragment w-divide then generate a fragment z value (16-bit) and a fragment color (16-bit) which were passed down to the FBI.<br/>
<br/>
To be able to query four banks at a time, texture dimensions had to be multiple of two and no adjacent texels could be stored in the same bank. The following 16x16 smiley shows the texels layout.<br/>
<br/>
<img loading="lazy" src="drawing_banks_split.svg" width="196.87535mm" height="96.12912mm" style="width: 100%; height: auto; "/></p>

<div class='heading'>FBI 2-way interleave</div><hr/><p>
  The solution to the two RAM access in the FBI stage is not explicitly mentioned in the specs. However the document does mention a fillrate of 100 MPixels/second on glClear due to the ability to write two pixels/clock which suggests a 2-way interleave was used there.<br/>
  <br/>
<img loading="lazy" src="fbi_2_ways.svg" width="318.22894mm" height="106.71651mm" style="width: 100%; height: auto; margin-bottom:2ch;"/>  <br/>
  The FBI read and wrote pixels two at a time (2 x 1 pixel made of 16-bit color and 16-bit z = 64 bits). To do that, the 21-bit address generates two 20-bit where the least significant bit is discarded to read/write two consecutive pixels. Since the scanline algorithm required to write/read on horizontal lines going from left to right, reading two consecutive pixels at a time worked very well.
</p>

<div class='heading'>TMU->FBI 64-bit bus</div><hr/><p>
  The last piece of the puzzle is the 64-bit FBI-TMU bus. There is next to nothing in the specs about this but the behavior can be inferred from what the FBI consumes. Since the FBI worked two-pixels at a time, it is reasonable to assume the TMU did not send texels as fast as possible but instead batched them two at a time as two 16-bit color + 16-bit z-value.
  </p>

<div class='heading'>Programming the Voodoo1 </div><hr/><p>
  At its lowest level, programming the Voodoo1 was done using memory mapped registers. The API is made of a surprisingly low number of five register commands TRIANGLECMD (fixed-point), FTRIANGLECMD (floating-point), NOPCMD (no-op), FASTFILLCMD (buffer clear), and SWAPBUFFERCMD associated with a load of data registers to configure blending, z-test, upload a fog color, and many more. Textures upload to VRAM was done via 8MiB of PCI write-only memory-mapped RAM.<br/>
  <br/>
      To mitigate pipeline starvation, the card featured a memory backed command FIFO which allowed it to push thousands of commands without waiting for completion. According to John Carmack this mechanism was key to sustained performance<a name="back_6" style="text-decoration: none;" href="index.html#footnote_6"><sup>[6]</sup></a>.
</p>

<div class='heading'>Programming the Voodoo1 (for real)</div><hr/><p>
  For developers, programming the Voodoo1 was done through its Glide API<a name="back_7" style="text-decoration: none;" href="index.html#footnote_7"><sup>[7]</sup></a>. The design of the API was logically inspired of IRIS GL/OpenGL, with a state machine and prefixes for everything (except that it used "gr" instead of "gl" and programmers had to manage VRAM like in Vulkan.)

  <!-- https://tohtml.com/ -->


<pre style="color:#000000;background:#ffffff;"><span style="color:#004a43; ">#</span><span style="color:#004a43; ">include </span><span style="color:#800000; ">&lt;</span><span style="color:#40015a; ">glide.h</span><span style="color:#800000; ">&gt;</span>

<span style="color:#800000; font-weight:bold; ">void</span> <span style="color:#400000; ">main</span><span style="color:#808030; ">(</span> <span style="color:#800000; font-weight:bold; ">void</span> <span style="color:#808030; ">)</span> <span style="color:#800080; ">{</span>
   GrHwConfiguration hwconfig<span style="color:#800080; ">;</span>
   grGlideInit<span style="color:#808030; ">(</span><span style="color:#800000; font-weight:bold; ">void</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
   grSstSelect<span style="color:#808030; ">(</span> <span style="color:#008c00; ">0</span> <span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
   grSstQueryHardware<span style="color:#808030; ">(</span><span style="color:#808030; ">&amp;</span>hwconfig<span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>

   grSstSelect<span style="color:#808030; ">(</span><span style="color:#008c00; ">0</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
   grSstWinOpen<span style="color:#808030; ">(</span>null<span style="color:#808030; ">,</span> GR_RESOLUTION_640x480<span style="color:#808030; ">,</span> GR_REFRESH_60HZ<span style="color:#808030; ">,</span> 
     GR_COLORFORMAT_RGBA<span style="color:#808030; ">,</span> GR_ORIGIN_LOWER_LEFT<span style="color:#808030; ">,</span> <span style="color:#008c00; ">2</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">0</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
   grBufferClear<span style="color:#808030; ">(</span><span style="color:#008c00; ">0</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">0</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">0</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>

   GrVertex A<span style="color:#808030; ">,</span> B<span style="color:#808030; ">,</span> C<span style="color:#800080; ">;</span>
   <span style="color:#808030; ">.</span><span style="color:#808030; ">.</span><span style="color:#808030; ">.</span> <span style="color:#696969; ">// Init A, B, and C.</span>

   guColorCombineFunction<span style="color:#808030; ">(</span> GR_COLORCOMBINE_ITRGB <span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
   grDrawTriangle<span style="color:#808030; ">(</span><span style="color:#808030; ">&amp;</span>A<span style="color:#808030; ">,</span> <span style="color:#808030; ">&amp;</span>B<span style="color:#808030; ">,</span> <span style="color:#808030; ">&amp;</span>C<span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>

   grBufferSwap<span style="color:#808030; ">(</span> <span style="color:#008c00; ">1</span> <span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>

   grGlideShutdown<span style="color:#808030; ">(</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
<span style="color:#800080; ">}</span>

</pre>



</p>

<div class='heading'>MiniGL "standard"</div><hr/><p style="margin-bottom: 0;">
  Even though MiniGL was a subset of the OpenGL 1.1 standard, there was never a spec for it. MiniGL was "whatever functions Quake uses". Utility objdump running against quake.exe binary makes it easy to build an "official" list.<br/>
  <pre>
$ objdump -p glquake.exe | grep " gl"

glAlphaFunc      glDepthMask        glLoadIdentity      glShadeModel
glBegin          glDepthRange       glLoadMatrixf       glTexCoord2f
glBlendFunc      glDisable          glMatrixMode        glTexEnvf
glClear          glDrawBuffer       glOrtho             glTexImage2D
glClearColor     glEnable           glPolygonMode       glTexParameterf
glColor3f        glEnd              glPopMatrix         glTexSubImage2D
glColor3ubv      glFinish           glPushMatrix        glTranslatef
glColor4f        glFrustum          glReadBuffer        glVertex2f
glColor4fv       glGetFloatv        glReadPixels        glVertex3f
glCullFace       glGetString        glRotatef           glVertex3fv
glDepthFunc      glHint             glScalef            glViewport
</pre>
<p style="margin-bottom: 0;">
If you learned OpenGL recently, you may be intrigued by function names such as glColor3f, glTexCoord2f, glVertex3f, glTranslatef, glBegin, and glEnd. These were used for something called "Immediate mode" where vertex coordinates, texture coordinates, matrix manipulation and color were specified one function call at a time.<br/>
<br/>
Here is how one textured and gouraud shaded triangle was drawn "back in the days".


<!-- https://tohtml.com/ -->


<pre style="color:#000000;background:#ffffff;"><span style="color:#800000; font-weight:bold; ">void</span> Render <span style="color:#800080; ">{</span>     
    <span style="color:#400000; ">glClear</span><span style="color:#808030; ">(</span>GL_COLOR_BUFFER_BIT <span style="color:#808030; ">|</span> GL_DEPTH_BUFFER_BIT<span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>

    <span style="color:#400000; ">glEnable</span><span style="color:#808030; ">(</span>GL_TEXTURE_2D<span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
    <span style="color:#400000; ">glShadeModel</span><span style="color:#808030; ">(</span>GL_SMOOTH<span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
    <span style="color:#400000; ">glBindTexture</span><span style="color:#808030; ">(</span>GL_TEXTURE_2D<span style="color:#808030; ">,</span> <span style="color:#008c00; ">1</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>  <span style="color:#696969; ">// Assume a texture was loaded in textureId=1</span>

    <span style="color:#400000; ">glMatrixMode</span><span style="color:#808030; ">(</span>GL_PROJECTION<span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
    <span style="color:#400000; ">glLoadIdentity</span><span style="color:#808030; ">(</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
    <span style="color:#400000; ">glOrtho</span><span style="color:#808030; ">(</span><span style="color:#808030; ">-</span><span style="color:#008000; ">1.0</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">1.0</span><span style="color:#808030; ">,</span> <span style="color:#808030; ">-</span><span style="color:#008000; ">1.0</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">1.0</span><span style="color:#808030; ">,</span> <span style="color:#808030; ">-</span><span style="color:#008000; ">1.0</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">1.0</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
    <span style="color:#400000; ">glMatrixMode</span><span style="color:#808030; ">(</span>GL_MODELVIEW<span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
    <span style="color:#400000; ">glLoadIdentity</span><span style="color:#808030; ">(</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
      
    <span style="color:#400000; ">glBegin</span><span style="color:#808030; ">(</span>GL_TRIANGLES<span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
      <span style="color:#400000; ">glColor3f</span><span style="color:#808030; ">(</span><span style="color:#008000; ">1.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">1.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">1.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
      <span style="color:#400000; ">glTexCoord2f</span><span style="color:#808030; ">(</span><span style="color:#008000; ">0.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">0.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
      <span style="color:#400000; ">glVertex3f</span><span style="color:#808030; ">(</span><span style="color:#808030; ">-</span><span style="color:#008000; ">1.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span><span style="color:#808030; ">-</span><span style="color:#008000; ">0.25</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span><span style="color:#008000; ">0.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>

      <span style="color:#400000; ">glColor3f</span><span style="color:#808030; ">(</span><span style="color:#008000; ">0.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">0.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">0.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
      <span style="color:#400000; ">glTexCoord2f</span><span style="color:#808030; ">(</span><span style="color:#008000; ">1.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">0.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
      <span style="color:#400000; ">glVertex3f</span><span style="color:#808030; ">(</span><span style="color:#808030; ">-</span><span style="color:#008000; ">0.5</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span><span style="color:#808030; ">-</span><span style="color:#008000; ">0.25</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span><span style="color:#008000; ">0.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>

      <span style="color:#400000; ">glColor3f</span><span style="color:#808030; ">(</span><span style="color:#008000; ">0.5</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">0.5</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">0.5</span><span style="color:#006600; ">f</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
      <span style="color:#400000; ">glTexCoord2f</span><span style="color:#808030; ">(</span><span style="color:#008000; ">0.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">1.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
      <span style="color:#400000; ">glVertex3f</span><span style="color:#808030; ">(</span><span style="color:#808030; ">-</span><span style="color:#008000; ">0.75</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span><span style="color:#008000; ">0.25</span><span style="color:#006600; ">f</span><span style="color:#808030; ">,</span><span style="color:#008000; ">0.0</span><span style="color:#006600; ">f</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
    <span style="color:#400000; ">glEnd</span><span style="color:#808030; ">(</span><span style="color:#808030; ">)</span><span style="color:#800080; ">;</span>
<span style="color:#800080; ">}</span>         
</pre>
<p></p>


<div class='heading'>GLQuake</div><hr/><p style="margin-bottom: 1ch;">
The theoretical maximum of 50MPixels/second fillrate should have delivered close to 50 frames per second in 640x480<a name="back_8" style="text-decoration: none;" href="index.html#footnote_8"><sup>[8]</sup></a>. However because Quake combined two texture layers per surface (one for the color and one for the lightmap), the SST1 had to draw each frame twice with additional blending on the second pass. As a result, combined to a P166Mhz, Quake ran at 26 fps.<br/>
<br/>
 Lowering the resolution to 512x384 on the same machine provided a butter smooth 41 fps<a name="back_9" style="text-decoration: none;" href="index.html#footnote_9"><sup>[9]</sup></a> which was beyond anything competitors of the time could achieve.<br/>

  <script type="text/javascript">
  function setCompareImage2(e) {
    document.getElementById('demo2_frame1324_software.png').src='demo2_frame1324_' + e.value + '.png';
    document.getElementById('demo2_frame1324_software.webp').srcset='demo2_frame1324_' + e.value + '.webp';
  }
</script>
<picture>
    <source srcset="demo2_frame1324_sst1.webp" id="demo2_frame1324_software.webp" type="image/webp">
    <img loading="lazy" src="demo2_frame1324_sst1.png" class="pixel" width="768" height="576" id="demo2_frame1324_software.png" style="width: 100%; height: auto; border: solid 1px; margin-top: 2ch; margin-bottom: 0ch;"/></picture>
<form > 
    <div style="width: 100%; display: inline-block; margin-top: 1ch;">
      <center>
        <label><input type="radio" name="demo2_frame1324" value="software" onclick="setCompareImage2(this);"> Software</label>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <label><input type="radio" name="demo2_frame1324" value="sst1" onclick="setCompareImage2(this);" checked="checked" > GLQuake Voodoo1</label>
      </center>
    </div>
</form>
<br/>
<p>
<b>Trivia:</b> The SST1 was not for everybody. Some people loved their pixels and found bilinear filtering "blurry". Some other people were annoyed with the loss of gamma correction.<br/>
<blockquote>
  Glquake looks like shit. I know a few of you may argue here, but really, lets face it - it looks terrible, especially on NVidia cards. Its not too bad on a 3dfx board... the colors are washed out though. On a TNT2 its disgraceful; way too dark and murky.<br/>
  <br/>
  <div>- @Frib, Unofficial Glquake & QW Guide<a name="back_10" style="text-decoration: none;" href="index.html#footnote_10"><sup>[10]</sup></a></div>
</blockquote>


</p>


<div class='heading'>3fdx Voodoo<sup>2</sup></div><hr/><p>
<img src="3dfx2_drawing.svg" style="float:right; margin-left: 2ch; width: 40%;">
  To say that 3dfx ruled from 1996 to 1998 would be an understatement. After the SST1, the Voodoo<sup>2</sup> doubled down on performance with 100Mhz EDO RAM, ASICs clocked at 
  90MHz, and not one but two TMUs allowing it to draw a Quake multitextured frame (color + lightning) in a single pass<a name="back_11" style="text-decoration: none;" href="index.html#footnote_11"><sup>[11]</sup></a>. The thing was a beast and even the hardware looked gorgeous.<br/>
  <br/> The fill-rate of a Voodoo<sup>2</sup> was nearly doubled to reach 90 MPixel/s. Quake benchmarks took off to an astonishing 80 fps on a Pentium II 266 MMX (compared to 56 fps with a Voodoo1) effectively maxing out both the game logic and display monitors.<br/>
  <br/>
<picture>
    <source srcset="Voodoo2_super_fhq12MiB.webp" type="image/webp">
    <img src="Voodoo2_super_fhq12MiB.jpg" width="100%" style="margin: 0ch; width: 100%;">
</picture>
<center style="margin-top: 1ch;"><i>Super Voodoo 2 12MB, courtesy of vgamuseum.info.</i></center>
<br/>
<p>
  
Unfortunately, the history of 3dfx took a cruel turn with the release of the Voodoo3 in 1999. As it was attempting to build its own all-in-one cards and stopped providing OEMs with its designs, the company had to face increasing competition.<br/>
<br/>The transition did not go as well as expected and Voodoo3 performance was judged disappointing compared to the GeForce 256 from NVidia which was capable of hardware T&amp;L (the part done by the Pentium in the pipeline).<br/>
<br/>
To counter NVidia, 3dfx canceled the Voodoo4 to work directly on the Voodoo5 featuring a VSA-100 (Voodoo Scalable Architecture). The plan did not go as expected when the "Napalm" as it was nicknamed found itself faced with the more powerful NVidia's GeForce 2 and ATI Radeon cards upon release. Ultimately, on 28 March 2000, 3dfx filed for bankruptcy and was purchased by NVidia.<br/>
<br/>
To whoever lived through the late 90s and had the pleasure to run a Voodoo1 or Voodoo2, 3dfx remains an icon symbolizing excellence. An ode to a much deserved success achieved through audacity, exceptional talent and hard-work. Thanks guys :)!
</p>
<style type='text/css'>td.ref {  padding-bottom: 0ch; width:0;}</style><div class='heading'>References</div><hr/><p id='paperbox' style='text-align:left;'><table><tbody style='vertical-align: top;'><tr><td class='ref' style='width:1ch;'><a name="footnote_1"></a><a href="index.html#back_1">^</a></td><td  class='ref' style='width:4ch;'> [ 1]</td><td style='width:100%;text-align:left;' class='ref'><a href="../vquake/index.html">The story of the Rendition V&eacute;rit&eacute; 1000</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_2"></a><a href="index.html#back_2">^</a></td><td  class='ref' style='width:4ch;'> [ 2]</td><td style='width:100%;text-align:left;' class='ref'><a href="../fd_proxy/doom3/pdfs/johnc-plan_1998.pdf">John Carmack .plan. Feb 12, 1998</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_3"></a><a href="index.html#back_3">^</a></td><td  class='ref' style='width:4ch;'> [ 3]</td><td style='width:100%;text-align:left;' class='ref'><a href="http://www.o3one.org/hwdocs/video/voodoo_graphics.pdf">SST-1, HIGH PERFORMANCE GRAPHICS ENGINE FOR 3D GAME ACCELERATION</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_4"></a><a href="index.html#back_4">^</a></td><td  class='ref' style='width:4ch;'> [ 4]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://archive.computerhistory.org/resources/access/text/2014/05/102746834-05-01-acc.pdf">3dfx Oral History Panel</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_5"></a><a href="index.html#back_5">^</a></td><td  class='ref' style='width:4ch;'> [ 5]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.beyond3d.com/content/articles/8">Origin of Quake3's Fast InvSqrt()</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_6"></a><a href="index.html#back_6">^</a></td><td  class='ref' style='width:4ch;'> [ 6]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://twitter.com/ID_AA_Carmack/status/1114264502642663424">Tweet by John Carmac on Apr 4, 2019</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_7"></a><a href="index.html#back_7">^</a></td><td  class='ref' style='width:4ch;'> [ 7]</td><td style='width:100%;text-align:left;' class='ref'><a href="http://falconfly.3dfx.pl/downloads/3dfx-glide-programming-guide-rel018.zip">Glide Programming Guide</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_8"></a><a href="index.html#back_8">^</a></td><td  class='ref' style='width:4ch;'> [ 8]</td><td style='width:100%;text-align:left;' class='ref'>Don't forget to account for the depth buffer clear (3.45ms).</td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_9"></a><a href="index.html#back_9">^</a></td><td  class='ref' style='width:4ch;'> [ 9]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.soldcentralfl.com/quakecoop/compare1.htm">Comparison of Frame-rates in 
GLQuake Using Voodoo & Voodoo 2 3D Cards</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_10"></a><a href="index.html#back_10">^</a></td><td  class='ref' style='width:4ch;'> [10]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.quakewiki.net/archives/frib/glquake.html">Frib, Unofficial Glquake & QW Guide</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_11"></a><a href="index.html#back_11">^</a></td><td  class='ref' style='width:4ch;'> [11]</td><td style='width:100%;text-align:left;' class='ref'><a href="http://darwin-3dfx.sourceforge.net/voodoo2.pdf">VOODOO2 GRAPHICS HIGH PERFORMANCE GRAPHICS ENGINE FOR 3D GAME ACCELERATION</a></td></tr></tbody></table></p> <hr>
 <center>*