<html>
<head>
  <link rel="alternate" type="application/rss+xml"  title="RSS Feed for fabiensanglard.net" href="../rss.xml" />
  <style type="text/css">

    @font-face {
      font-family: 'fabfont';
      src: url('../font/DejaVuSansMono.woff2');
      font-display: block;
    }

    @font-face {
      font-family: 'fabfont';
      src: url('../font/DejaVuSansMono-Bold.woff2');
      font-weight: bold;
      font-display: block;
    }

    * {
       font-size: 16px;
    }

    html {
      font-family: fabfont,  monospace;
      max-width: 900px;  /* For Desktop PC (see @media for Tablets/Phones) */
      padding-left: 2%;
      padding-right: 3%;
      margin: 0 auto;
      background: #F5F5F0;
  	} 
    


  	a {
      color: black;
      font-weight: bold;
    }

    img {
      border: none; 
    }

    p {
      margin-top: 0px;
      text-align: justify;
    }
    sup {
      vertical-align: 0.3em;
      font-size: 0.65em;
    }   

    pre {
      font-family: fabfont, monospace;
      background-color: white; 
      border: 1px solid Black; 
      padding-left: 2%;
      padding-top: 1ch;
      padding-bottom: 1ch;
      /* Only take care of X overflow since this is the only part that can be too wide.
         The Y axis will never overflow.
      */
      overflow: hidden;
    }

    div.heading {
      font-weight: bold;      
      text-transform: uppercase;
      margin-top: 4ch;
    }

    /** {
      font-size: 16px;
    }*/
    @media (max-width: 500px) { /* For small screen decices */
      * {
        font-size: 12px; 
      }
    }   
    .title {
      text-decoration: none;
    }

    img.pixel, canvas.pixel {
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }

    blockquote { 
    background-color: #f3f3f3;
    border: dashed 1px grey; 
    width: 97.5%; 
    font-style: italic; 
    text-align: justify;

    padding: 1ch; 
    padding-top: 2ch; 
    padding-bottom: 2ch;     
    
    margin : 0ch; 
    margin-bottom: 2ch; 
    margin-top: 0ch;
  }

  blockquote div {
    text-transform: none;
    text-align: right;
    width: 100%;
  }

  code {
    /*font-size: 110%;*/
    font-weight: bold;
    background-color: #e1e1e1;
    border-radius: 0.5ch;
    padding-left: 0.3ch;
    padding-right: 0.3ch;
  }

  .trivia {
    border-left: 1px black solid;
    padding-left: 1ch;
  }

  .trivia::before {
  font-weight: bold;
  text-decoration: underline;
  padding-right: 1ch;
  content: "Trivia:";

  </style>
  <title>A tale of Ghosts'n Goblins'n Crocodiles</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=12.0, minimum-scale=1.0, user-scalable=yes">
</head>  
  <body><br><center>
    <div style="display: inline-block; vertical-align:middle;">
<a href="../index.html" class="title"><b>FABIEN SANGLARD'S WEBSITE</b><br>
</a><hr/><div style="text-align: justify;display: inline-block; width: 100%;">
<!-- <a class="title" href="/about/index.html">ABOUT</a> &nbsp;<a class="title" href="/contact/index.html">EMAIL</a> &nbsp;<a class="title" href="../rss.xml">RSS</a> &nbsp;<a class="title" href="https://paypal.me/fabiensanglard">DONATE</a></div></div> -->
<a class="title" href="../about/index.html">ABOUT</a> &nbsp;<a class="title" href="../contact/index.html">CONTACT</a> &nbsp;<a class="title" href="../rss.xml">RSS</a> &nbsp;<a class="title" href="https://paypal.me/fabiensanglard">GIVE</a></div></div>

</center><br><br>
<div style="margin-bottom: 2ch;text-transform: none;">
May 30, 2020</div>
<div class='heading'>A tale of Ghosts'n Goblins'n Crocodiles</div><hr/>
<style>
  img {
    border: solid 1px black;
  }
</style>

<p>
  <picture>
    <source srcset="arcade_flyer_title.webp" type="image/webp">
    <img loading="lazy" src="arcade_flyer_title.png" width="521" height="700" style="width: 30%; height: auto; float:right;margin-left: 2ch; margin-bottom: 1ch;"/>  </picture>
  When he was a kid, Sébastien Harelle was given a computer. It was Christmas 1988 and "ordinateurs" were finally starting to find their ways inside French homes.
  <br/>
  <br/>
  It was not Sébastien's first contact with such a machine. As early as 1985, following Laurent Fabius's "Computers for Everybody" plan<a name="back_1" style="text-decoration: none;" href="index.html#footnote_1"><sup>[1]</sup></a>, all elementary schools introduced children to Logo programming via  star-connected<a name="back_2" style="text-decoration: none;" href="index.html#footnote_2"><sup>[2]</sup></a> Thomson MO5s.
<br/>
  <br/>
   This computer did not have network capability but it was full-fledged with a monitor and a floppy disc unit integrated in the keyboard. Turning it on brought up a blue background and yellow text home-screen displaying "BASIC 1.0 Ready" and a prompt.
  <br/>
  <br/>
  Soon he was spending entire evenings at his desk. Besides programming, there was an immense catalog of games available. After inserting a floppy disk and typing "RUN DISC"<a name="back_3" style="text-decoration: none;" href="index.html#footnote_3"><sup>[3]</sup></a>, he was welcomed to the realms of Gryzor, Barbarian, and Renegade.
  <br/>
  <br/>
  Sébastien did not know it at the time but like many other French kids he would end up developing an ever-lasting appreciation for that machine, the Amstrad CPC.
  <br/>
</p>

<div class='heading'>Amstrad, the King of 8-bit in France and UK</div><hr/><p style="margin-bottom: 2ch;">
  <picture>
    <source srcset="amstrad_logo.webp" type="image/webp">
    <img loading="lazy" src="amstrad_logo.png" width="2043" height="1023" style="width: 30%; height: auto; float:right;margin-left: 2ch; margin-bottom: 1ch;"/>  </picture>
  If you are not from France or the UK and if you were not born in the late 70s, chances are you have no idea what an Amstrad CPC is. To put it in one sentence, Amstrad took the 8-bit home computer market by storm in the mid-80s thanks to great advertising and low prices.
 <br/>
 <br/>
  It is Christmas 1985 and you want to buy your kids a computer. On one side, you have a C64 with 64KiB RAM for $149. It can display 16 colors and also has features you don't understand like hardware sprites and soft-scrolling. You will also have to buy a floppy drive ($272) and a TV ($293). On the other side, you have an Amstrad CPC 464 with similar specs except it comes with a screen, has a higher resolution and only costs $472<a name="back_4" style="text-decoration: none;" href="index.html#footnote_4"><sup>[4]</sup></a><a name="back_5" style="text-decoration: none;" href="index.html#footnote_5"><sup>[5]</sup></a><a name="back_6" style="text-decoration: none;" href="index.html#footnote_6"><sup>[6]</sup></a>. Which one do you buy?

<blockquote>
  My concept was simple: Mum and Dad don’t want little Johnny taking over the TV set, so our computer should come with its own monitor, have a full-sized keyboard and a built-in cassette mechanism for loading software and hit a target price of £199. This way, little Johnny could have it in his bedroom, freeing up the family TV.
  <br/>
  <br/>
  <div>- Alan Sugar (Amstrad founder)<a name="back_7" style="text-decoration: none;" href="index.html#footnote_7"><sup>[7]</sup></a></div>
</blockquote>

<p>
 <table style="width: 100%; height: auto;table-layout:fixed;">
  <tr>
    <td style="width: 50%; height: auto; text-align: left;">
  <picture>
    <source srcset="LOrdinateurIndividuel-67-Feb85-Page-016.webp" type="image/webp">      
      <img loading="lazy" src="LOrdinateurIndividuel-67-Feb85-Page-016.jpg" width="1168" height="1666" style="width: 99.8%; height: auto; margin-top: 2ch; margin-bottom: 1ch;"/>    </picture>
    </td>
    <td style="width: 50%; height: auto; text-align: right;">
  <picture>
    <source srcset="LOrdinateurIndividuel-67-Feb85-Page-017.webp" type="image/webp">          
      <img loading="lazy" src="LOrdinateurIndividuel-67-Feb85-Page-017.jpg" width="1171" height="1668" style="width: 100%; height: auto; margin-top: 2ch; margin-bottom: 1ch;"/>    </picture>
    </td>
  </tr>
 </table>
  <span style="text-align: center; display: block; margin-bottom: 1ch;"><i><small>Amstrad double-page heavy advertising of the tape based CPC 464 (1985).</small></i></span>
 <br/>
 Alan Sugar's formula worked. Perhaps beyond his wildest expectations. After its release in April 1984, the 464 was shipped to 1 million customers. Amstrad doubled down the next year in August 1985 with its CPC 6128 featuring 128 KiB of RAM, a drive using floppies instead of tapes, and a sleeker black and white design. From 1985 to 1990 Amstrad reportedly shipped around 3 millions units. During that time period, if you were talking about computers during recess, it was likely an Amstrad.<br/>
 <table style="width: 100%; height: auto;table-layout:fixed;">
  <tr>
    <td style="width:50%; height: auto; text-align: left;">
  <picture>
    <source srcset="pub1.webp" type="image/webp">          
      <img loading="lazy" src="pub1.jpg" width="1119" height="1600" style="width: 99.8%; height: auto; margin-top: 2ch; margin-bottom: 1ch;"/>    </picture>
    </td>
    <td style="width: 50%; height: auto; text-align: right;">
        <picture>
    <source srcset="pub2.webp" type="image/webp"> 
      <img loading="lazy" src="pub2.jpg" width="1119" height="1600" style="width: 100%; height: auto; margin-top: 2ch; margin-bottom: 1ch;"/>    </picture>
    </td>
  </tr>
 </table>
  <span style="text-align: center; display: block; margin-bottom: 2ch;"><i><small>Amstrad's CPC 6128, good for gaming (yea!) and education (they wished!).</small></i></span>
  
<b><u>Trivia:</u></b> How much of an influence these machines had on French and British kids? Let's just say that some of them may have designed their keyboard to harbor Amstrad colors.<br/>
 <a href="ergo_cpc.jpg">
  <picture>
    <source srcset="ego_cpc_small.webp" type="image/webp">
    <img loading="lazy" src="ego_cpc_small.png" width="900" height="387" style="width: 100%; height: auto; float:right;margin-left: 2ch; margin-bottom: 1ch; margin-top: 2ch;"/>  </picture>
 </a>
    <span style="text-align: center; display: block; margin-bottom: 0ch;"><i><small>Ergodox evidence A-1.</small></i></span>
</p>	




<div class='heading'>Amstrad CPC architecture</div><hr/><p style="margin-bottom: 2ch;">
 Based on a Z80 CPU running at 4Mhz with 64KiB RAM, the CPC was the finest machine to program. Besides built-in BASIC, its great asset was its video system which resolution far surpassed its competitors. The ZX-Spectrum could reach 256×192 and the C64 320x200. The CPC on the other end had three modes offering 160x200/16colors, 320x200/4colors, and 640x200/2colors.
<br/>
 <br/> 
What was even better about the CRTC system is that developer could pick the palette colors. It was a little bit weird with its three shade per channel but it results in 27 colors available.
 <br/>
 <br/> 
 <table  width=100% border="1" cellpadding="0" cellspacing="0" style="border-collapse:collapse;">
 <tr>
<td style="padding-bottom: 8%; background-color: rgb(0, 0, 0);">&nbsp;</td>
<td style="background-color: rgb(0, 0, 128);">&nbsp;</td>
<td style="background-color: rgb(0, 0, 255);">&nbsp;</td>
<td style="background-color: rgb(128, 0, 0);">&nbsp;</td>
<td style="background-color: rgb(128, 0, 128);">&nbsp;</td>
<td style="background-color: rgb(128, 0, 255);">&nbsp;</td>
<td style="background-color: rgb(255, 0, 0);">&nbsp;</td>
<td style="background-color: rgb(255, 0, 128);">&nbsp;</td>
<td style="background-color: rgb(255, 0, 255);">&nbsp;</td>
</tr>

<tr>
<td style="background-color: rgb(0, 128, 0);">&nbsp;</td>
<td style="background-color: rgb(0, 128, 128);">&nbsp;</td>
<td style="background-color: rgb(0, 128, 255);">&nbsp;</td>
<td style="background-color: rgb(128, 128, 0);">&nbsp;</td>
<td style="background-color: rgb(128, 128, 128);">&nbsp;</td>
<td style="background-color: rgb(128, 128, 255);">&nbsp;</td>
<td style="background-color: rgb(255, 128, 0);">&nbsp;</td>
<td style="padding-bottom: 8%; background-color: rgb(255, 128, 128);">&nbsp;</td>
<td style="background-color: rgb(255, 128, 255);">&nbsp;</td>
</tr>

<tr>
<td style="background-color: rgb(0, 255, 0);">&nbsp;</td>
<td style="background-color: rgb(0, 255, 128);">&nbsp;</td>
<td style="background-color: rgb(0, 255, 255);">&nbsp;</td>
<td style="background-color: rgb(128, 255, 0);">&nbsp;</td>
<td style="background-color: rgb(128, 255, 128);">&nbsp;</td>

<td style="background-color: rgb(128, 255, 255);">&nbsp;</td>
<td style="background-color: rgb(255, 255, 0);">&nbsp;</td>
<td style="padding-bottom: 8%; background-color: rgb(255, 255, 128);">&nbsp;</td>
<td style="background-color: rgb(255, 255, 255);">&nbsp;</td>
</tr>
</table>
<span style="text-align: center; display: block; margin-bottom: 2ch;margin-top: 1ch;"><i><small>The uncanny 27 values colorspace of the Amstrad CPC.</small></i></span>


When it came to animation and video-games however, the great asset turned to be a great in-balance. If the CRTC supported double buffering at the cost of half the total RAM, the CPU still had to write 16KiB to draw a whole screen. That was twice the amount of a ZX-Spectrum without the hardware sprites of a C64.
<br/>

  <pre style="width:46ch; height: auto; margin-left:2%; margin-bottom: 2ch;float:right;text-align: left;overflow: hidden; margin-top: 0; font-size: smaller">
Line|ROW1 ROW2 ROW3 ROW4 ROW5 ROW6 ROW7 ROW8        
====|=======================================
 1  |C000 C800 D000 D800 E000 E800 F000 F800
 2  |C050 C850 D050 D850 E050 E850 F050 F850
 3  |C0A0 C8A0 D0A0 D8A0 E0A0 E8A0 F0A0 F8A0
 4  |C0F0 C8F0 D0F0 D8F0 E0F0 E8F0 F0F0 F8F0
 5  |C140 C940 D140 D940 E140 E940 F140 F940
 6  |C190 C990 D190 D990 E190 E990 F190 F990
 7  |C1E0 C9E0 D1E0 D9E0 E1E0 E9E0 F1E0 F9E0
 8  |C230 CA30 D230 DA30 E230 EA30 F230 FA30
 9  |C280 CA80 D280 DA80 E280 EA80 F280 FA80
10  |C2D0 CAD0 D2D0 DAD0 E2D0 EAD0 F2D0 FAD0
11  |C320 CB20 D320 DB20 E320 EB20 F320 FB20
12  |C370 CB70 D370 DB70 E370 EB70 F370 FB70
13  |C3C0 CBC0 D3C0 DBC0 E3C0 EBC0 F3C0 FBC0
14  |C410 CC10 D410 DC10 E410 EC10 F410 FC10
15  |C460 CC60 D460 DC60 E460 EC60 F460 FC60
16  |C4B0 CCB0 D4B0 DCB0 E4B0 ECB0 F4B0 FCB0
17  |C500 CD00 D500 DD00 E500 ED00 F500 FD00
18  |C550 CD50 D550 DD50 E550 ED50 F550 FD50
19  |C5A0 CDA0 D5A0 DDA0 E5A0 EDA0 F5A0 FDA0
20  |C5F0 CDF0 D5F0 DDF0 E5F0 ED50 F550 FD50
21  |C640 CE40 D640 DE40 E640 EE40 F640 FE40
22  |C690 CE90 D690 DE90 E690 EE90 F690 FE90
23  |C6E0 CEE0 D6E0 DEE0 E6E0 EEE0 F6E0 FEE0
24  |C730 CF30 D730 DF30 E730 EF30 F730 FF30
25  |C780 CF80 D780 DF80 E780 EF80 F780 FF80 </pre>
<p style="margin-bottom: 1ch;"> 
	 The task of animation was considerably complicated by the convoluted video layout expected by the CRTC.

 <br/>
 <br/>
 Regardless of the mode, the screen is always 200 pixels tall and always divided in 25 lines of characters (each 8 rows tall). The table on the right shows where a CRTC starting at 0xC000 would expect each row for each line of character. 
 <br/>
 <br/>
Rows are not expected sequentially but 8-way interleaved. That means that a simple BASIC program to clear the screen by filling 16KiB linearly would first draw Line1, row1 (at 0xC000) then, 8 pixels below, Line2, row1 (at 0xC050), then Line3, row1 (at 0xC0A0), and so on.
 <br/>
 <pre>
FOR i=&C000 TO &FFFF:POKE i,255:NEXT<a name="back_8" style="text-decoration: none;" href="index.html#footnote_8"><sup>[8]</sup></a></pre>
 <p>
 This description does not even factor in when the CRTC start address has been changed or when the screen have been scrolled left or right.

 <br/>
 <br/>
 You may have a hard time imagining how to move sprites with such a system. Working with only a raster interrupt, a character based (8 pixels) scroller, and a CPU did not deter game developers. Far from shying away, they deployed treasures of ingenuity resulting in a list of 1,776 games<a name="back_9" style="text-decoration: none;" href="index.html#footnote_9"><sup>[9]</sup></a> of which many came from the world of arcades.<br/> 
</p>




<div class='heading'>Enters Ghosts'n Goblins</div><hr/><p>
Ghosts and Goblins was released in arcades during Fall 1985 by Capcom. It was so well received that it became a franchise currently counting twelve titles<a name="back_10" style="text-decoration: none;" href="index.html#footnote_10"><sup>[10]</sup></a>.
<br/>
<br/>
  To rescue an abducted lover, the hero had to face hordes of Zombies, Magicians, Skeletons, Red Arremers, and Flying Knights to name only a few. Bosses such as Unicorns, Dragons, Satan, and the chief Astaroth were gorgeous and well-animated. The PCB's Motorola 6809 1Mhz was rather weak but boosted by huge DMA "object" movers<a name="back_11" style="text-decoration: none;" href="index.html#footnote_11"><sup>[11]</sup></a>, it commanded a resolution of 256x224 with 256 colors<a name="back_12" style="text-decoration: none;" href="index.html#footnote_12"><sup>[12]</sup></a> and hordes of huge sprites at 60fps. It was splendid.
  <br/>
  <br/>
  It was also an unforgiving game. Enemies popped from everywhere with hard to predict patterns and privileged aiming directions. Dodging attacks was difficult since once triggered the trajectory of a jump could not be adjusted. Get hit once and your armor explodes, leaving you running around in your undies. Get hit another time and you have to start over.
 <br/>
  <img loading="lazy" src="0004_landscape.png" class="pixel" width="256" height="100" style="width: 100%; height: auto; margin-top: 2ch; margin-bottom: 1ch;"/>  <span style="text-align: center; display: block; margin-bottom: 2ch;"><i><small>Ghosts'n Goblins, arcade, 1985.</small></i></span>
 


The game was ported to home computers the following year. Thanks to its Blitter co-processor, the 16-bit Amiga reached stellar quality<a name="back_13" style="text-decoration: none;" href="index.html#footnote_13"><sup>[13]</sup></a> with the Atari ST not too far behind<a name="back_14" style="text-decoration: none;" href="index.html#footnote_14"><sup>[14]</sup></a>. However when it came to PC<a name="back_15" style="text-decoration: none;" href="index.html#footnote_15"><sup>[15]</sup></a>, C64<a name="back_16" style="text-decoration: none;" href="index.html#footnote_16"><sup>[16]</sup></a> and CPC<a name="back_17" style="text-decoration: none;" href="index.html#footnote_17"><sup>[17]</sup></a>, the quality of the ports dropped sharply.
 <br/>
 <br/>
On these three platforms, the story was butchered to the point it is unclear why the hero is running around and facing monsters. There is no introduction where Astaroth captures the princess and therefore no story. The game was also considerably shorter since out of the six levels from the arcade, only four made it home. The C64 version could be completed in 7mn.
</p>

<div class='heading'>Ghosts'n Goblins on CPC</div><hr/> 
  <div style="width: 45%; height: auto; float:right;margin-left: 2ch; margin-bottom: 1ch;">

<img loading="lazy" src="gng_trick.png" class="pixel" width="384" height="272" style="width: 100%; height: auto; margin-bottom:1ch;"/>
<span style="text-align: center; display: block; margin-bottom: 1ch;"><i><small>Explanation credit: cpc-power.com<a name="back_18" style="text-decoration: none;" href="index.html#footnote_18"><sup>[18]</sup></a>.</small></i></span>
</div>
<p>
The CPC version of Ghosts'n Goblins is interesting to study because it is both terrible and terrific.
<br/> 
<br/>
It is terrible in terms of polish. The hero awkwardly jumps without bending his knees. Arthur cannot lose his armor and dies upon first hit. There is no start and no end. To be fair, it is likely the development team was given at best a few weeks to do it all without access to any of the original assets. 
<br/> 
<br/>
That being said, the game is terrific in terms of what the engine does in order to improve the framerate.
<br/> 
<br/>
As alluded earlier, the CPC's Z80 could not refresh a whole screen without dropping to a single digit framerate. Yet, adamant to run in full screen with huge sprites, developer Nigel Alderton came up with a trick. He used Mode 0 (160x200 w/ 16 colors) but chose to split each nibble in two. Four colors are used for the background and 12 colors are aliased into three for the sprites.
<br/>
 <table  width="100%" border="1" cellpadding="0" cellspacing="0" style="margin-top:2ch; border-collapse:collapse; text-align: center; margin-bottom: 2ch; ">
<!--   <tr>
    <td colspan="4" style="padding-bottom: 1ch; padding-top: 1ch;">Backgrounds</td>
    <td colspan="3" >Sprites</td>
  </tr> -->
 <tr>
<td style="background-color: rgb(0, 0, 0); color: white; padding-top:1ch; padding-bottom:1ch;">00-00</td>
<td style="background-color: rgb(123, 125, 123);">00-01</td>
<td style="background-color: rgb(0, 125, 0);color: white;">00-10</td>
<td style="background-color: rgb(123, 0, 0);color: white;">00-11</td>

<td style="background-color: #FFF;">01-XX</td>
<td style="background-color: #00F;color: white;">10-XX</td>
<td style="background-color: rgb(255, 125, 0);">11-XX</td>


</tr>
</table>
 The technique allows only seven colors on screen but enable to move sprites without having to write back the background which saves RAM and CPU cycles.
 <br/>
  <br/>
 Even though it left some TV modulator screaming in pain<a name="back_19" style="text-decoration: none;" href="index.html#footnote_19"><sup>[19]</sup></a>, Nigel also managed to smooth out the normally choppy (2 byte increment) hardware scroll. While the scroller moves the logical screen left, he used careful timing to move the physical location to the right. 
</p>

<div class='heading'>The death of Amstrad</div><hr/><p>
Besides issues with the fillrate, CPC developers had to deal with what I call the "Atari ST curse" where despite having 128KiB of RAM, CPC 6128 games only used 64KiB out of the 128KiB available in order to be compatible with the 1 million CPC 464 already on the market.
<br/>
 <br/>
To make things worse, despite some polished titles such as Gryzor and Renegade, the practice of Speccy ports<a name="back_20" style="text-decoration: none;" href="index.html#footnote_20"><sup>[20]</sup></a> where ZX Spectrum games were shoved straight into CPCs gave ammunition to Amstrad haters. The platform developed a bad gaming rep.
<br/>
 <br/>
As a remedy the British company released in September 1990 a "Plus" range made of the 464+, the 6128+, and the GX4000. If the technology was still based on a Z80 CPU, the video system was augmented to a 12-bit RGB (32 colors out of 4,096) and an ASIC chip which gifted developers with 16 hard sprites, soft scrolling, and DMA transfer to feed the audio chip automagically.
  <br/>
  <picture>
    <source srcset="gx4000.webp" type="image/webp">
    <img loading="lazy" src="gx4000.jpg" width="1280" height="529" style="width: 100%; height: auto; margin-top: 2ch; margin-bottom: 1ch;"/>  </picture>	
    <span style="text-align: center; display: block; margin-bottom: 2ch;"><i><small>Amstrad GX4000. (Photo credit: wikipedia.com).</small></i></span>

Unfortunately, by that time the industry had started to enter the 16-bit era. The 8-bit Z80 machines from Amstrad suffered when compared to Sega's Genesis and Nintendo's Super Famicom. Customers shunned the "+" line and developers dragged their feet by producing 27, mostly sub-par, games which were often "Direct Disk to Cartridge" ports<a name="back_21" style="text-decoration: none;" href="index.html#footnote_21"><sup>[21]</sup></a>. 
 <br/>
 <br/>
 Discounted within a few months after their introduction, without a real opportunity to show what they could produce, the "+" machines were an engineering success but a commercial failure from which Amstrad never recovered.
</p>




<div class='heading'>Retro-gaming movement and the resurgence of the CPC scene</div><hr/><p style="margin-bottom: 2ch;">
After the demise of the CPC, Sébastien and his generation moved onto other platforms. It would be years until Seb would become reacquainted with the world of Amstrad via cpcwiki.eu forum. In the Retrogaming movement, going under the nickname "Xifos", Seb found himself surrounded with people who shared his love for the CPCs but also occasionally read diverging opinions.<br/>
<blockquote>
In the past fifteen years it has become trendy in the retro-gaming world to bad mouth the Amstrad CPC. The "+" range in particular is mocked and I thought it was not justified from a technical standing point. The only flaw really was to have been released a few years too late.
<br/><br/>
I came across some of these people bad mouthing the CPC around the same time I noticed that someone had done a port of Ghosts'n Goblins on Colecovision.
<br/><br/>
 I thought it would be a good game to demonstrate what could really be done with the CPC+.
<br/><br/>
<div>- Sébastien Harelle</div>	
</blockquote>

</p>












<div class='heading'>GHOSTS'N GOBLINS ON CPC+</div><hr/><p style="margin-bottom: 2ch;">
	And so it happened. Almost on a lark, Seb embarked in a project to make the best port of Ghosts'n Goblins he could for the platform he loved. If at first he was not sure in which direction to go, things clarified themselves quickly.
<blockquote>
	I started to tinker with the 6128+ to get myself used to the new capabilities and particularly the ASIC. Eventually another CPC enthusiast named TotO suggested to produce a cartridge  targeting the GX4000. I especially liked the idea since the console is by far the most hated piece of hardware in the "Plus" range. 
<br/><br/>
2016 is when Ghosts'n Goblins on GX4000 really got started. At first there was the question of what would be the RAM budget. The GX4000 and 464+ could receive a memory extension but I decided against it since it would not have been commercially viable back in the days. I elected to use the stock configuration which is 64KiB.
<br/><br/>
Then came the question of the cartridge storage capacity. I also wanted to use what game developers of the time had which was either 128KiB or 256KiB.
<br/><br/>
In terms of framerate, the goal was to max out the TV. The console was never released on NTSC so that meant running at the 50Hz of PAL. 
<br/><br/>
<div>- Sébastien Harelle</div>	
</blockquote>
<p style="margin-bottom: 2ch;">
Besides setting the target hardware constraints, Seb's most important design decision was to establish the screen layout. He ended up reconfiguring the CRTC and using the raster interrupt to switch resolution mid-frame.<br/>

<blockquote>
The CRTC is set to display 200 rows of 80 bytes which result in either 640, 320, or 160 horizontal pixels depending on the mode. Counting in characters this means the screen is 40x26 characters but you can reconfigure the CRTC to display more (overscan) or less. I chose to use 32x28 (so a bit more narrower and taller).
<br/><br/>
There is a top part which is 32x4 characters in Mode 1 (256x32) for the HUD and a bottom part which is 32x24 characters in Mode 0 (128x192 -8 horizontally for scrolling). 
<br/><br/>
It is advantageous to have 64 bytes lines (instead of 80) since it simplify screen addressing, especially when scrolling. Using a narrower screen made of 64 bytes was common during the years 1985-1993.
<br/><br/>
<div>- Sébastien Harelle</div>  
</blockquote>

<p>
  While manipulating the CRTC was something already doable with the CPC, what is more interesting is the new hardware in the CPC+.<br/>
</p>



<div class='heading'>Ghosts'n Goblins GX4000 internals</div><hr/><p style="margin-bottom: 2ch;">
	From an engineering perspective, the GX4000 was a tour-de-force. It managed to preserve 100% backward capability while providing augmenting capabilities. The video system for example remains unchanged with Mode 0, 1, and 2. However thanks to the ASIC an extra layer of sprites with its own palette could be added on top of the background<a name="back_22" style="text-decoration: none;" href="index.html#footnote_22"><sup>[22]</sup></a>.
	<br/>
  
    <img loading="lazy" src="cplcplus_arch.svg" width="210.91072mm" height="64.100334mm" style="width: 100%; height: auto; margin-top: 2ch; margin-bottom: 1ch;"/>    <span style="text-align: center; display: block; margin-bottom: 2ch;"><i><small>GX4000 architecture.</small></i></span>


<blockquote>
The powerhouse of the machine  of course is the ASIC chip which allows 16 sprites of 16x16 pixels  in 15 colors using a color palette separate for the rest of the video system. There is a little bit of inefficiency where the ASIC expects a sprite pixel to be encoded on a byte (8 bits) even though only a nibble (4 bits) is used. Instead of 16 sprites of 256 bytes each it would have been preferable to have 32 sprites of 128 bytes.
<br/><br/>
The sprites count limitation is important. You can't just use soft sprites (a.k.a drawn in the background layer) when you run out of hard sprites. For example the colors of the sprite may not be available in the background palette.
<br/><br/>
The soft scrolling capability solves many problems although there are a few subtle things to get everything right.
<br/><br/>
There is this common misconception that the GX4000 handles soft scrolling fully. In fact, it works a lot like the CPC hardware scroller except you can easily add a delay to the 8 pixels offset resulting in a smooth one pixel offset. But you still have to handle cycling and shifting yourself.
<br/><br/>
Also, the scroller does not allow increment to a resolution inferior to the current mode. Since the background is in mode 0 I make the background move only every other frame to get the desired visual scrolling speed.
<br/><br/>
The raster interrupt splits the screen in two vertically with the HUD in Mode 1 128*32 and the rest of the screen in Mode 0 128*192 so you have to be careful when scrolling to keep the upper part static.
<br/><br/>
In terms of audio, the DMA has three channels to automatically feed the three audio channels. These are taken care of by Arkos player which Targhan used for the music.
<br/><br/>
<div>- Sébastien Harelle</div>	
</blockquote>

 <table style="width: 100%; height: auto;table-layout:fixed;margin-top: 0;">
  <tr>
    <td style="width: 50%; height: auto; text-align: left;">      
      <img loading="lazy" src="intro_anim.gif" class="pixel" width="248" height="225" style="width: 99.8%; height: auto; margin-top: 2ch; margin-bottom: 1ch;"/>    </td>
    <td style="width: 50%; height: auto; text-align: right;">
      <img loading="lazy" src="many_anim.gif" class="pixel" width="248" height="225" style="width: 100%; height: auto; margin-top: 2ch; margin-bottom: 1ch;"/>    </td>
  </tr>
 </table>
 <span style="text-align: center; display: block; margin-bottom: 2ch;"><i><small>Sprites bounding box. Arthur and most enemies use two each.</small></i></span>

<blockquote>
  To save on RAM and storage, I kept the sprites "compressed" (1 pixel/nibble) and only decompress them when they are transferred from RAM to the ASIC. I did not use multiplexing because it did not help much but I used compounding like when Satan appears in the intro which consumes six sprites.
<br/><br/>
To reduce sprite consumption, I made elements that spawn but don't move (plant enemies, bonuses, ...) be "soft sprites" backed into the background.
<br/><br/>
Another side effect of the hard sprite limitation is that I originally had Arthur limited to having on shot in-flight. Since the sheltering-in-place I have managed to add a second one but I have not released it.
<br/><br/>
<div>- Sébastien Harelle</div>  
</blockquote>

</p>


<div class='heading'>Toolchain and packaging</div><hr/><p style="margin-bottom: 0;">

	<blockquote>
To program the game I started with a plain C file and hand-tuned some functions with inline ASM.
Using SDCC compiler and WinApe emulator allowed to iterate fast. A build + deployment took 30 seconds.
<br/><br/>
For the gameplay and sprites, my starting point was the arcade version. I designed the maps with tilestudio and drew the sprites with PaintShop Pro 5. I did not have an artist to draw any of the assets so I did it all by myself.
<br/><br/>
I also received numerous mini contributions from the CPC community. TotO for example did the HUD but I also received help from Fano, Ast, ArnoldEmu, Vingazole, Templeton, Ced, and Kukulkan (I hope I did not forget anybody).
<br/><br/>
<div>- Sébastien Harelle</div>  
</blockquote>

<blockquote>
The cartridge ended up at 256KiB with 16 blocks of 16KiB. All data pertaining to a level is grouped into blocks to ease loading/unloading.  
<br/>
<br/>
block 0&nbsp;&nbsp;&nbsp;&nbsp;: code. <br/>
block 1&nbsp;&nbsp;&nbsp;&nbsp;: Add-on code, HUD assets, Dragon assets, Scoareboard assets. <br/>
block 2&nbsp;&nbsp;&nbsp;&nbsp;: Mirrored hard-sprites data. <br/>
block 3&nbsp;&nbsp;&nbsp;&nbsp;: Hard-sprites data. <br/>
block 4&nbsp;&nbsp;&nbsp;&nbsp;: Title screen (splash). <br/>
block 5-11 : Level 1-7 (gfx, map, enemies). <br/>
block 12&nbsp;&nbsp;&nbsp;: Mirrored Hard-sprite data (boss) <br/>
block 13&nbsp;&nbsp;&nbsp;: Hard-sprites data (boss) <br/>
block 14&nbsp;&nbsp;&nbsp;: Misc gfx data, Musics, SFX. <br/>
block 15&nbsp;&nbsp;&nbsp;: Arkos audio player, More music. <br/><br/>
<div>- Sébastien Harelle</div>  
</blockquote> 

</p>

<div class='heading'>Musics and Sound effects</div><hr/><p style="margin-bottom: 2ch;">
  Even though it was not his specialty, Xifos produced music and sound effects. That was until he released a preview which Julien Névo, a.k.a Targhan, came across.<br/>

  <blockquote>
  I came across Xifos preview when he posted it on the CPC Wiki. I was impressed with it but I pointed out that the music that he had came up with was not on par with the quality of the rest of his game. 
  <br/><br/>
  I asked if I could contribute and Xifos accepted. We were very efficient in the sense that I completed all the music within two weeks in early May 2018.
  <br/><br/>
  I worked 100% with STarKos directly on a real CPC because I did not feel confident to use Arkos Tracker 2 yet. Since Xifos used Arkos Tracker 1 (AT1) player, I just had to export to this format and my music was in the game!
  <br/><br/>
<div>- Julien Névo</div>  
</blockquote>
</p>


<div class='heading'>Shipping it!</div><hr/><p style="margin-bottom: 2ch;">
In May 2018, after two years of work, Sébastien and Julien <a href="https://www.cpc-power.com/index.php?page=detail&num=12807">shipped</a> their project<a name="back_23" style="text-decoration: none;" href="index.html#footnote_23"><sup>[23]</sup></a>. The high quality of the game was a testimony to a relentless effort fueled by passion and dedication.
<br/>

  <picture>
    <source srcset="gg/all.webp" type="image/webp">
<img loading="lazy" src="gg/all.png" class="pixel" width="746" height="674" style="width: 100%; height: auto; margin-top: 2ch; margin-bottom: 1ch;"/></picture>
  <span style="text-align: center; display: block; margin-bottom: 2ch;"><i><small>Ghosts'n Goblins GX4000. Better 35 years later than never!</small></i></span>

 The community praised the professional quality. All six levels, all animations, all bosses, and all the weapons were there. The 32 colors were used wisely, the music was amazing, and the framerate high. I highly recommend to get <a href="http://www.winape.net/">WinAPE</a> emulator and <a href="https://www.cpc-power.com/index.php?page=detail&num=12807">play it</a>.<br/>
<blockquote>
  This is the Ghosts'n Goblins the Amstrad deserves.
<br/>
<br/>
<div>- Xyphoe<a name="back_24" style="text-decoration: none;" href="index.html#footnote_24"><sup>[24]</sup></a></div>  
</blockquote>


<blockquote>
It's bloody fantastic! [...] This proves what the system could have done then.
<br/>
<br/>
<div>- Novabug<a name="back_25" style="text-decoration: none;" href="index.html#footnote_25"><sup>[25]</sup></a></div>  
</blockquote>

<blockquote>
  "Ghosts'n Goblins" receives a spectacular remake for the Amstrad GX4000!
<br/>
<br/>
<div>- gx4000.co.uk<a name="back_26" style="text-decoration: none;" href="index.html#footnote_26"><sup>[26]</sup></a></div>  
</blockquote>
<p>
"What is the moral of this story?" you may ask. I think it is pretty clear. Next time you are thinking about bad-mouthing the CPC, think twice. It may take two years but someone will make you eat your words!

</p>


<div class='heading'>Epilogue</div><hr/><p style="margin-bottom: 2ch;">
In March 2004, John Carmack shared an uplifting opinion about people still developing for the Jaguar, long after the Atari console had been discontinued.
<blockquote>
There is something noble about developing on a dead platform -- it is so completely for the joy of the development, without any commercial motivation.  
    <br/><br/>
<div>- John Carmack</div>  
</blockquote>

<p>
When does a platform truly "dies"? A "dead language" is defined as "a language which is no longer in everyday spoken use". By analogy, a platform would die not when it ceases to be profitable or when it is obsolete, but when people stop playing it and caring about it. 
<br/>
<br/>
Now the question becomes "what draws people to retro-computing?". Is it nostalgia, the diversity, the creativity, the simplicity, or is it inexplicably fun? 

<br/>
<br/>
I thought about it and I could not come up with a definitive answer. One thing, however is certain. For those who grew up with them, these machines will go on to live "forever".<br/>
</p>



<style type='text/css'>td.ref {  padding-bottom: 0ch; width:0;}</style><div class='heading'>References</div><hr/><p id='paperbox' style='text-align:left;'><table><tbody style='vertical-align: top;'><tr><td class='ref' style='width:1ch;'><a name="footnote_1"></a><a href="index.html#back_1">^</a></td><td  class='ref' style='width:4ch;'> [ 1]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://fr.wikipedia.org/wiki/Plan_informatique_pour_tous">Plan informatique pour tous</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_2"></a><a href="index.html#back_2">^</a></td><td  class='ref' style='width:4ch;'> [ 2]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://fr.wikipedia.org/wiki/Nanor%C3%A9seau">Nanoréseau</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_3"></a><a href="index.html#back_3">^</a></td><td  class='ref' style='width:4ch;'> [ 3]</td><td style='width:100%;text-align:left;' class='ref'>Some twisted titles required 'ùCPM'.</td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_4"></a><a href="index.html#back_4">^</a></td><td  class='ref' style='width:4ch;'> [ 4]</td><td style='width:100%;text-align:left;' class='ref'><a href="LOrdinateur&#32;Individuel-73-Sep85-Page-023.jpg">L'Ordinateur Individuel Sep 86, p23</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_5"></a><a href="index.html#back_5">^</a></td><td  class='ref' style='width:4ch;'> [ 5]</td><td style='width:100%;text-align:left;' class='ref'><a href="LOrdinateur&#32;Individuel-73-Sep85-Page-024.jpg">L'Ordinateur Individuel Sep 86, p24</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_6"></a><a href="index.html#back_6">^</a></td><td  class='ref' style='width:4ch;'> [ 6]</td><td style='width:100%;text-align:left;' class='ref'><a href="LOrdinateur&#32;Individuel-73-Sep85-Page-025.jpg">L'Ordinateur Individuel Sep 86, p25</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_7"></a><a href="index.html#back_7">^</a></td><td  class='ref' style='width:4ch;'> [ 7]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.theregister.co.uk/Print/2014/02/12/archaeologic_amstrad_cpc_464/">You’re NOT fired: The story of Amstrad’s amazing CPC 464</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_8"></a><a href="index.html#back_8">^</a></td><td  class='ref' style='width:4ch;'> [ 8]</td><td style='width:100%;text-align:left;' class='ref'><a href="http://www.irespa.eu/daan/lib/howtoCPCemu.htm">How to write an Amstrad CPC emulator</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_9"></a><a href="index.html#back_9">^</a></td><td  class='ref' style='width:4ch;'> [ 9]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://en.wikipedia.org/wiki/List_of_Amstrad_CPC_games">List of Amstrad CPC games</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_10"></a><a href="index.html#back_10">^</a></td><td  class='ref' style='width:4ch;'> [10]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://en.wikipedia.org/wiki/Ghosts_%27n_Goblins">Ghosts'n Goblins series</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_11"></a><a href="index.html#back_11">^</a></td><td  class='ref' style='width:4ch;'> [11]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://github.com/mamedev/mame/blob/master/src/mame/drivers/gng.cpp#L26">Mame Gng Driver (gng.cpp)</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_12"></a><a href="index.html#back_12">^</a></td><td  class='ref' style='width:4ch;'> [12]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://github.com/mamedev/mame/blob/master/src/mame/drivers/gng.cpp#L421">Mame Gng Palette (gng.cpp)</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_13"></a><a href="index.html#back_13">^</a></td><td  class='ref' style='width:4ch;'> [13]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.youtube.com/watch?v=ERtkhZx0f-A">Ghosts'n Goblins Amiga 500 longplay by World-of-Longplays</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_14"></a><a href="index.html#back_14">^</a></td><td  class='ref' style='width:4ch;'> [14]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.youtube.com/watch?v=wB8Jw6OW9-c">Ghosts'n Goblins Atari ST longplay by Greenlog</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_15"></a><a href="index.html#back_15">^</a></td><td  class='ref' style='width:4ch;'> [15]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.youtube.com/watch?v=Gw4A1SSAql8">Ghosts'n Goblins PC longplay by World-of-Longplays</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_16"></a><a href="index.html#back_16">^</a></td><td  class='ref' style='width:4ch;'> [16]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.youtube.com/watch?v=rHjUJNYD_GY">Ghosts'n Goblins C64 longplay by 
Zeusdaz</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_17"></a><a href="index.html#back_17">^</a></td><td  class='ref' style='width:4ch;'> [17]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.youtube.com/watch?v=tIlTIzvyiBcY">Ghosts'n Goblins CPC longplay by 
World-of-Longplays</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_18"></a><a href="index.html#back_18">^</a></td><td  class='ref' style='width:4ch;'> [18]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.cpc-power.com/index.php?page=detail&num=974">Ghosts'N Goblins CPC Mode 0, 7 colors</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_19"></a><a href="index.html#back_19">^</a></td><td  class='ref' style='width:4ch;'> [19]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://cpcrulez.fr/coding_src-list-graphic-hardware_scroll__TAU.htm">Ghosts'n Goblins Hardware Scroll, The Amstrad User magazine</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_20"></a><a href="index.html#back_20">^</a></td><td  class='ref' style='width:4ch;'> [20]</td><td style='width:100%;text-align:left;' class='ref'><a href="http://www.cpcwiki.eu/index.php/Speccy_Port">Speccy Ports</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_21"></a><a href="index.html#back_21">^</a></td><td  class='ref' style='width:4ch;'> [21]</td><td style='width:100%;text-align:left;' class='ref'><a href="http://www.cpcwiki.eu/index.php/Direct_Disk_to_Cartridge_Port">CPC, Direct Disk to Cartridge</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_22"></a><a href="index.html#back_22">^</a></td><td  class='ref' style='width:4ch;'> [22]</td><td style='width:100%;text-align:left;' class='ref'><a href="http://quasar.cpcscene.net/doku.php?id=assem:asic">L'ASIC</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_23"></a><a href="index.html#back_23">^</a></td><td  class='ref' style='width:4ch;'> [23]</td><td style='width:100%;text-align:left;' class='ref'><a href="http://www.cpcwiki.eu/forum/games/ghosts'n-goblins-gx4000-is-out-!/">Ghosts'n Goblins GX4000 is out !</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_24"></a><a href="index.html#back_24">^</a></td><td  class='ref' style='width:4ch;'> [24]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://www.youtube.com/watch?v=61RvtoU8PmY&feature=youtu.be&t=232">Xyphoe review</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_25"></a><a href="index.html#back_25">^</a></td><td  class='ref' style='width:4ch;'> [25]</td><td style='width:100%;text-align:left;' class='ref'><a href="https://youtu.be/ZCJFyKi8STM?t=152">Novabug review</a></td></tr><tr><td class='ref' style='width:1ch;'><a name="footnote_26"></a><a href="index.html#back_26">^</a></td><td  class='ref' style='width:4ch;'> [26]</td><td style='width:100%;text-align:left;' class='ref'><a href="http://gx4000.co.uk/main/ghostsn-goblins-receives-a-spectacular-remake-for-the-amstrad-gx4000/">gx4000.co.uk announcement</a></td></tr></tbody></table></p> <hr>
 <center>*